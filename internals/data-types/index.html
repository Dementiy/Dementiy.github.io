


<!doctype html>
<html lang="ru" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Лекции и практические задания по программированию на Python">
      
      
        <link rel="canonical" href="https://dementiy.github.io/internals/data-types/">
      
      
        <meta name="author" content="Sorokin Dmitrii">
      
      <link rel="shortcut icon" href="../../images/kitano.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.6">
    
    
      
        <title>Data types - Программирование на Python</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.63b94e9e.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.7f672a1f.min.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-111461883-1","dementiy.github.io"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview",document.location.pathname)})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Перейти к содержанию
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://dementiy.github.io/" title="Программирование на Python" class="md-header-nav__button md-logo" aria-label="Программирование на Python">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Программирование на Python
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Data types
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Поиск" placeholder="Поиск" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/Dementiy/pybook-assignments/" title="Перейти к репозиторию" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Dementiy/pybook-assignments
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../lectures/immutable-types/" class="md-tabs__link">
          Лекции
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../assignments/setup_env/" class="md-tabs__link">
          Практические работы
        </a>
      
    </li>
  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../notes/cross-entropy/" class="md-tabs__link">
          Заметки
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://dementiy.github.io/" title="Программирование на Python" class="md-nav__button md-logo" aria-label="Программирование на Python">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Программирование на Python
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/Dementiy/pybook-assignments/" title="Перейти к репозиторию" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Dementiy/pybook-assignments
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Лекции
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Лекции" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Лекции
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../lectures/immutable-types/" title="Неизменяемые типы данных" class="md-nav__link">
      Неизменяемые типы данных
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lectures/mutable-types/" title="Изменяемые типы данных" class="md-nav__link">
      Изменяемые типы данных
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lectures/control-statements/" title="Управляющие конструкции" class="md-nav__link">
      Управляющие конструкции
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lectures/functions/" title="Функции" class="md-nav__link">
      Функции
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lectures/ns_and_scopes/" title="Простарнство имен и области видимости" class="md-nav__link">
      Простарнство имен и области видимости
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lectures/classes/" title="ООП. Классы. Магические методы" class="md-nav__link">
      ООП. Классы. Магические методы
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lectures/descriptors/" title="ООП. Дескрипторы" class="md-nav__link">
      ООП. Дескрипторы
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lectures/attribute_lookup/" title="ООП. Разрешение имен атрибтутов" class="md-nav__link">
      ООП. Разрешение имен атрибтутов
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lectures/mro/" title="ООП. Порядок разрешения методов" class="md-nav__link">
      ООП. Порядок разрешения методов
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lectures/iterators/" title="Итераторы" class="md-nav__link">
      Итераторы
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Практические работы
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Практические работы" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Практические работы
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      Basics
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Basics" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Basics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../assignments/setup_env/" title="Настройка рабочего окружения" class="md-nav__link">
      Настройка рабочего окружения
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../assignments/cypher/" title="Алгоритмы шифрования" class="md-nav__link">
      Алгоритмы шифрования
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../assignments/sudoku/" title="Решатель Судоку" class="md-nav__link">
      Решатель Судоку
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../assignments/life/" title="Игра «Жизнь»" class="md-nav__link">
      Игра «Жизнь»
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../assignments/pyvcs/" title="PyVCS. Распределенная система контроля версий" class="md-nav__link">
      PyVCS. Распределенная система контроля версий
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../assignments/vk_api/" title="Работа с API ВКонтакте" class="md-nav__link">
      Работа с API ВКонтакте
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Заметки
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Заметки" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Заметки
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../notes/cross-entropy/" title="Энтропия и кросс-энтропия" class="md-nav__link">
      Энтропия и кросс-энтропия
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    Все является объектом
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    Кортежи
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                  <h1>Data types</h1>
                
                <h2 id="_1">Все является объектом</h2>
<p>В Python все является объектом («Everything is an Object»): числа, последовательности, функции, классы, модули и т.д. Каждый объект обладает уникальным идентификатором, который никогда не изменяется после создания объекта (в CPython идентификатором объекта является его адрес в памяти, который можно получить с помощью встроенной функции <code>id()</code>), типом, который определяет «чем является объект» (числом, строкой, списком и т.д.) и какие действия над ним можно выполнять, а также значением.</p>
<p>Каждый объект «наследуется» от Си-структуры <a href="https://github.com/python/cpython/blob/3.8/Include/object.h#L104"><code>PyObject</code></a> или <a href="https://github.com/python/cpython/blob/3.8/Include/object.h#L113"><code>PyVarObject</code></a> для объектов переменной (variable) длинны (списки, кортежи и т.д.):</p>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span> <span class="k">struct</span> <span class="n">_object</span> <span class="p">{</span>
    <span class="n">_PyObject_HEAD_EXTRA</span>
    <span class="n">Py_ssize_t</span> <span class="n">ob_refcnt</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">_typeobject</span> <span class="o">*</span><span class="n">ob_type</span><span class="p">;</span>
<span class="p">}</span> <span class="n">PyObject</span><span class="p">;</span>
</code></pre></div>

<p>Где:</p>
<ul>
<li><code>_PyObject_HEAD_EXTRA</code> - макрос, который определяет два поля <code>_ob_next</code> и <code>_ob_prev</code> - указатели на следующий и предыдущий объекты, соответственно. Будут ли эти поля включены в структуру <code>PyObject</code> или нет - зависит от флага <code>Py_TRACE_REFS</code>, который по умолчанию не установлен;</li>
<li><code>ob_refcnt</code> - счетчик ссылок на объект, который увеличивается или уменьшается, при копировании или удалении указателя на объект; когда счетчик ссылок достигает нуля, то объект удаляется. Про подсчет ссылок и «сборку мусора» мы будем говорить в одной из следующих лекций;</li>
<li><code>ob_type</code> - указатель на структуру <a href="https://docs.python.org/3/c-api/typeobj.html"><code>_typeobject</code></a>, которая задает тип объекта.</li>
</ul>
<p>Структура <code>PyVarObject</code> включает одно дополнительное поле <code>ob_size</code> - количество элементов в объекте (например, для списка из пяти элементов <code>ob_size</code> будет равен 5):</p>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">PyObject</span> <span class="n">ob_base</span><span class="p">;</span>
    <span class="n">Py_ssize_t</span> <span class="n">ob_size</span><span class="p">;</span> <span class="cm">/* Number of items in variable part */</span>
<span class="p">}</span> <span class="n">PyVarObject</span><span class="p">;</span>
</code></pre></div>

<p>Связи между соответствующими структурами показаны на следующем рисунке:</p>
<p><img alt="image" class="center" src="../../images/lectures/immutable-types/pyobject.svg" /></p>
<p>Итак, если вы решили ввести свой тип, то он должен «наследоваться» от <code>PyObject</code> или <code>PyVarObject</code> с помощью макросов <code>PyObject_HEAD</code> и <code>PyObject_VAR_HEAD</code>:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#define PyObject_HEAD          PyObject ob_base;</span>
<span class="p">...</span>
<span class="cp">#define PyObject_VAR_HEAD      PyVarObject ob_base;</span>
</code></pre></div>

<p>Например:</p>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span> <span class="k">struct</span> <span class="n">_myobject</span> <span class="p">{</span>
       <span class="n">PyObject_HEAD</span>
       <span class="p">...</span>
<span class="p">}</span> <span class="n">PyMyObject</span><span class="p">;</span>
</code></pre></div>

<p>Таким образом, <code>PyMyObject</code> будет содержать все поля, которые есть в <code>PyObject</code>.</p>
<p>Следует помнить, что макрос <code>PyObject_HEAD</code> должнен идти первым в структуре. Это связано с «наследованием», о котором говорилось ранее. Как утверждается в <a href="https://github.com/python/cpython/blob/3.8/Include/object.h#L43"><code>object.h</code></a>:</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>Objects are always accessed through pointers of the type <code>PyObject *</code>.
The type <code>PyObject</code> is a structure that only contains the reference count
and the type pointer.  The actual memory allocated for an object
contains other data that can only be accessed after casting the pointer
to a pointer to a longer structure type.  This longer type must start
with the reference count and type fields; the macro <code>PyObject_HEAD</code> should be
used for this (to accommodate for future changes).  The implementation
of a particular object type can cast the object pointer to the proper
type and back.</p>
</div>
<p>и означает, что должна быть возможность приведения (casting) указателя на <code>PyMyObject</code> к указателю на <code>PyObject</code>, то есть:</p>
<div class="highlight"><pre><span></span><code><span class="n">PyObject</span> <span class="o">*</span><span class="n">obj</span> <span class="o">=</span> <span class="p">(</span><span class="n">PyObject</span><span class="o">*</span><span class="p">)</span><span class="n">my_py_type_variable</span><span class="p">;</span>
</code></pre></div>

<p>Итак, <code>PyObject</code> и <code>PyVarObject</code> являются наиболее общими структурами для представления объектов в CPython, но пока мы не говорили о том как создаются новые объекты. В одной из последующих лекций мы вернемся к этому вопросу.</p>
<h3>Длинная арифметика в Python</h3>
<p>Может ли произойти переполнение при работе с целыми числами в Python? Нет, если мы <strong>не</strong> говорим о таких пакетах как Numpy и Pandas, так как при работе с целыми числами в Python используется <a href="https://ru.wikipedia.org/wiki/%D0%94%D0%BB%D0%B8%D0%BD%D0%BD%D0%B0%D1%8F_%D0%B0%D1%80%D0%B8%D1%84%D0%BC%D0%B5%D1%82%D0%B8%D0%BA%D0%B0">длинная арифметика</a><sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>.</p>
<p>Структура <a href="https://github.com/python/cpython/blob/3.8/Include/longintrepr.h#L85"><code>PyLongObject</code></a> отвечает за представление целых чисел:</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span> <span class="n">_longobject</span> <span class="p">{</span>
    <span class="n">PyObject_VAR_HEAD</span>
    <span class="n">digit</span> <span class="n">ob_digit</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span> <span class="n">PyLongObject</span><span class="p">;</span>
</code></pre></div>

<p>Если «раскрыть» макрос <code>PyObject_VAR_HEAD</code>, то стурктура будет выглядеть следующим образом:</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span> <span class="n">_longobject</span> <span class="p">{</span>
    <span class="kt">ssize_t</span> <span class="n">ob_refcnt</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">_typeobject</span> <span class="o">*</span><span class="n">ob_type</span><span class="p">;</span>
    <span class="kt">ssize_t</span> <span class="n">ob_size</span><span class="p">;</span> 
    <span class="kt">uint32_t</span> <span class="n">ob_digit</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span> <span class="n">PyLongObject</span><span class="p">;</span>
</code></pre></div>

<p>Связи между соответствующими структурами показаны на следующем рисунке:</p>
<p><img alt="image" class="center" src="../../images/lectures/immutable-types/longobject.svg" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Вы должны были заметить, что <code>PyLongObject</code> «наследуется» от <code>PyVarObject</code>, то есть является объектом переменной длины, и, таким образом, включает поле <code>ob_size</code>, которое в данном случае содержит размер массива <code>ob_digit</code>.</p>
</div>
<p>Все поля вам уже должны быть знакомы, <code>PyLongObject</code> добавляет лишь одно новое поле <code>ob_digit</code> - массив беззнаковых целых чисел по основанию <span><span class="MathJax_Preview">2^{30}</span><script type="math/tex">2^{30}</script></span>. Давайте разберемся с назначением этого поля.</p>
<h3>Представление произвольно больших целых чисел</h3>
<p>Как хранить произвольно большое целое число? Одним из решений является представление целого числа в виде массива отдельных цифр. Для наиболее эффективного использования памяти мы можем конвертировать наше число из десятичной системы счисления в систему счисления по основанию <span><span class="MathJax_Preview">2^{30}</span><script type="math/tex">2^{30}</script></span>, в таком случае каждый элемент представлен «цифрой» в диапазоне от <span><span class="MathJax_Preview">0</span><script type="math/tex">0</script></span> до <span><span class="MathJax_Preview">2^{30} - 1</span><script type="math/tex">2^{30} - 1</script></span>. В зависимости от платформы Python использует или 32-битные беззнаковые массивы с 30-битными цифрами или 16-битные беззнаковые массивы с 15-битными цифрами. Такой подход представления больших целых чисел связан с <a href="https://github.com/python/cpython/blob/865e4b4f630e2ae91e61239258abb58b488f1d65/Include/longintrepr.h#L9">дополнительными ограничениями</a>, которые и не позволяют использовать все биты. Поле <code>ob_digit</code> структуры показанной выше, содержит такие массивы цифр. </p>
<p>Для избежания лишних вычислений в CPython есть эффективный способ представления целых чисел в диапазоне от <span><span class="MathJax_Preview">-2^{30}</span><script type="math/tex">-2^{30}</script></span> до <span><span class="MathJax_Preview">2^{30}</span><script type="math/tex">2^{30}</script></span>. Такие целые числа хранятся как массивы с одним элементом, то есть, состоящие из одной цифры.</p>
<p>Также следует отметить, что в отличие от классического представления знака числа (т.е. использования знакового бита), знак целого числа хранится в поле <code>ob_size</code>, которое также содержит размер массива <code>ob_digit</code>. Например, если мы хотим изменить знак целого с размером <code>ob_size=2</code> (две цифры), то <code>ob_size</code> станет равным <code>-2</code>.</p>
<p>Комментарий из исходных текстов по представлению целых чисел:</p>
<div class="highlight"><pre><span></span><code><span class="cm">/* Long integer representation.</span>
<span class="cm">   The absolute value of a number is equal to</span>
<span class="cm">   SUM(for i=0 through abs(ob_size)-1) ob_digit[i] * 2**(SHIFT*i)</span>
<span class="cm">   Negative numbers are represented with ob_size &lt; 0;</span>
<span class="cm">   zero is represented by ob_size == 0.</span>
<span class="cm">   In a normalized number, ob_digit[abs(ob_size)-1] (the most significant</span>
<span class="cm">   digit) is never zero.  Also, in all cases, for all valid i,</span>
<span class="cm">   0 &lt;= ob_digit[i] &lt;= MASK.</span>
<span class="cm">   The allocation function takes care of allocating extra memory</span>
<span class="cm">   so that ob_digit[0] ... ob_digit[abs(ob_size)-1] are actually available.</span>

<span class="cm">   CAUTION:  Generic code manipulating subtypes of PyVarObject has to aware that integers abuse  ob_size&#39;s sign bit.</span>
<span class="cm">*/</span>
</code></pre></div>

<p>Давайте рассмотрим конкретный пример преобразования длинного целого в массив и обратно. Пусть у нас имеется следующее число: <span><span class="MathJax_Preview">123456789101112131415</span><script type="math/tex">123456789101112131415</script></span>. Переведем его в систему счисления по основанию <span><span class="MathJax_Preview">2^{30}</span><script type="math/tex">2^{30}</script></span>, путем последовательного деления и записи остатка от деления:</p>
<p><img alt="image" class="center" src="../../images/lectures/types/from10to230.svg" /></p>
<p>Конвертировать число обратно также достаточно просто:</p>
<div>
<div class="MathJax_Preview">(437976919 ∗ 2^{30 ∗ 0}) + (87719511 ∗ 2^{30 ∗ 1}) + (107 ∗ 2^{30 ∗ 2}) = 123456789101112131415</div>
<script type="math/tex; mode=display">(437976919 ∗ 2^{30 ∗ 0}) + (87719511 ∗ 2^{30 ∗ 1}) + (107 ∗ 2^{30 ∗ 2}) = 123456789101112131415</script>
</div>
<p><img alt="image" class="center" src="../../images/lectures/immutable-types/longobject2.svg" /></p>
<h3>Преобразования длинного целого в массив</h3>
<p>Ниже приведен упрощенный вариант алгоритма представления произвольно больших чисел:</p>
<div class="highlight"><pre><span></span><code><span class="n">SHIFT</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># Число бит под каждую «цифру»</span>
<span class="n">MASK</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">SHIFT</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">split_number</span><span class="p">(</span><span class="n">bignum</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">bignum</span><span class="p">)</span>

    <span class="n">num_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">t</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Взятие остатка от деления</span>
        <span class="n">small_int</span> <span class="o">=</span> <span class="n">t</span> <span class="o">%</span> <span class="n">MASK</span>  <span class="c1"># Побитовый аналог: (t &amp; (MASK-1))</span>
        <span class="n">num_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">small_int</span><span class="p">)</span>

        <span class="c1"># Взятие целой части от деления</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">//</span> <span class="n">MASK</span>  <span class="c1"># Побитовый аналог: t &gt;&gt;= SHIFT</span>

    <span class="k">return</span> <span class="n">num_list</span>

<span class="k">def</span> <span class="nf">restore_number</span><span class="p">(</span><span class="n">num_list</span><span class="p">):</span>
    <span class="n">bignum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">num_list</span><span class="p">):</span>
        <span class="n">bignum</span> <span class="o">+=</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">SHIFT</span> <span class="o">*</span> <span class="n">i</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">bignum</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">bignum</span> <span class="o">=</span> <span class="mi">123456789101112131415</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">num_list</span> <span class="o">=</span> <span class="n">split_number</span><span class="p">(</span><span class="n">bignum</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">num_list</span>
<span class="p">[</span><span class="mi">437976919</span><span class="p">,</span> <span class="mi">87719511</span><span class="p">,</span> <span class="mi">107</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">bignum</span> <span class="o">==</span> <span class="n">restore_number</span><span class="p">(</span><span class="n">num_list</span><span class="p">)</span>
<span class="bp">True</span>
</code></pre></div>

<p>Если мы хотим убедиться, что нигде не ошиблись, то можем посмотреть на внутреннее представление целого числа с помощью модуля <a href="https://docs.python.org/3/library/ctypes.html">ctypes</a>, который позволяет взаимодействовать с Си-кодом из Python:</p>
<p><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">ctypes</span>

<span class="k">class</span> <span class="nc">PyLongObject</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">Structure</span><span class="p">):</span>
    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;ob_refcnt&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ssize_t</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ob_type&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ob_size&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ssize_t</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ob_digit&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">bignum</span> <span class="o">=</span> <span class="mi">123456789101112131415</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">PyLongObject</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">bignum</span><span class="p">))</span><span class="o">.</span><span class="n">ob_digit</span><span class="p">):</span>
<span class="o">...</span>    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;ob_digit[{i}] = {d}&quot;</span><span class="p">)</span>
<span class="n">ob_digit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">437976919</span>
<span class="n">ob_digit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">87719511</span>
<span class="n">ob_digit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">107</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;ob_size:&quot;</span><span class="p">,</span> <span class="n">PyLongObject</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">bignum</span><span class="p">))</span><span class="o">.</span><span class="n">ob_size</span><span class="p">)</span>
<span class="n">ob_size</span><span class="p">:</span> <span class="mi">3</span>
</code></pre></div></p>
<h3>Оптимизации</h3>
<p>Небольшие целые числа в диапазоне от <code>-5</code> до <code>256</code> преаллоцируются в процессе инициализации интерпретатора. Так как целые числа являются неизменяемыми, то мы можем воспринимать их как <a href="https://en.wikipedia.org/wiki/Singleton_pattern">синглтоны</a>. Каждый раз, когда нам необходимо создать небольшое целое число (например, как результат некоторой арифметической операции), то вместо создания нового объекта, Python просто возвращает указатель на уже преаллоцированный объект. Это позволяет сократить количество потребляемой памяти и время затрачиваемое на вычисления при работе с небольшими целыми числами.</p>
<p>Давайте рассмотрим простой пример:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="mi">94220163919104</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="mi">94220163919136</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">id</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="mi">94220163919104</span>
</code></pre></div>

<p>Следует иметь ввиду, что структура <code>PyLongObject</code> занимает не менее 28 байт для каждого целого числа, то есть в три раза больше чем требуется под 64-битное целое в языке C.</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">sys</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="mi">28</span>
</code></pre></div>

<p>Из чего складывается такой размер? Указатель на структуру <code>_typeobject</code> занимает восемь байт, также по восемь байт занимают поля <code>ob_refcnt</code> и <code>ob_size</code>, что уже в сумме дает нам 24 байта. Каждый элемент массива <code>ob_digit</code> это еще четыре байта. Итого для небольших целых чисел требуется 28 байт. Но есть одно исключение - <a href="https://stackoverflow.com/a/10365639/1724257">ноль</a>:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">sys</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="mi">24</span>
</code></pre></div>

<h3>Выполнение арифметических операций</h3>
<p>Базовые арифметические операции выполняются аналогично тому, как мы это делали когда-то в школе, с одним исключением: каждый элемент массива считается «цифрой».</p>
<p>Давайте рассмотрим вариант алгоритма сложения с <a href="https://en.wikipedia.org/wiki/Carry_(arithmetic)">переносом</a>:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">add_bignum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="c1"># Убедимся, что в «a» наибольшее из двух значений</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>

    <span class="n">carry</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)):</span>
        <span class="n">carry</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">carry</span> <span class="o">%</span> <span class="n">MASK</span><span class="p">)</span>
        <span class="n">carry</span> <span class="o">=</span> <span class="n">carry</span> <span class="o">//</span> <span class="n">MASK</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
        <span class="n">carry</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">carry</span> <span class="o">%</span> <span class="n">MASK</span><span class="p">)</span>
        <span class="n">carry</span> <span class="o">=</span> <span class="n">carry</span> <span class="o">//</span> <span class="n">MASK</span>

    <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">carry</span><span class="p">)</span>

    <span class="c1"># Удалим завершающие нули</span>
    <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">z</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">8223372036854775807</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">100037203685477</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">restore_number</span><span class="p">(</span><span class="n">add_bignum</span><span class="p">(</span><span class="n">split_number</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">split_number</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span> <span class="o">==</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="bp">True</span>
</code></pre></div>

<h3>Замечание про Numpy и Pandas</h3>
<p>В тех случаях, когда мы пользуемся библиотеками numpy/scipy/pandas и т.д., может произойти переполнение при работе с целыми числами, так как структуры, лежащие в основе этих библиотек, для более эффективного использования памяти, полагаются на соответствующие С-типы ограниченной точности<sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup>:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="o">**</span><span class="mi">63</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">63</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ar</span>
<span class="n">array</span><span class="p">([</span><span class="mi">9223372036854775807</span><span class="p">,</span> <span class="mi">9223372036854775807</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ar</span><span class="o">.</span><span class="n">dtype</span>
<span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span>
</code></pre></div>

<p>Элементами <code>ndarray</code> являются 64-битные знаковые целые, таким обрзаом, <span><span class="MathJax_Preview">2^{63}-1</span><script type="math/tex">2^{63}-1</script></span> наибольшее положительное значение, которое мы можем хранить в <code>ndarray</code>. Добавление 1 приведет к  переполнению (overflow):</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">ar</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">9223372036854775808</span><span class="p">,</span> <span class="o">-</span><span class="mi">9223372036854775808</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
<span class="o">-</span><span class="mi">2</span>
</code></pre></div>

<p>При вычислении среднего элементы массива сначала приводятся к типу <code>float</code> и переполнения не возникает:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
<span class="mf">9.2233720368547758e+18</span>
</code></pre></div>

<h3>Числа с плавающей точкой и стандарт IEEE-754</h3>
<p>Вещественные числа в CPython представлены структурой <a href="https://github.com/python/cpython/blob/3.8/Include/floatobject.h#L15"><code>PyFloatObject</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">PyObject_HEAD</span>
    <span class="kt">double</span> <span class="n">ob_fval</span><span class="p">;</span>
<span class="p">}</span> <span class="n">PyFloatObject</span><span class="p">;</span>
</code></pre></div>

<p><img alt="image" class="center" src="../../images/lectures/immutable-types/floatobject.svg" /></p>
<p>Легко заметить, что поле <code>ob_fval</code> это обычное вещественное число двойной точности. Все арифметические операции над вещественными числами в Python являются простыми обертками над соответствующими арифметическими операциями в Си, например, операция <a href="https://github.com/python/cpython/blob/master/Objects/floatobject.c#L534">сложения</a> определена следующим образом:</p>
<div class="highlight"><pre><span></span><code><span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span>
<span class="nf">float_add</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">w</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">;</span>
    <span class="n">CONVERT_TO_DOUBLE</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
    <span class="n">CONVERT_TO_DOUBLE</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
    <span class="n">PyFPE_START_PROTECT</span><span class="p">(</span><span class="s">&quot;add&quot;</span><span class="p">,</span> <span class="k">return</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
    <span class="n">PyFPE_END_PROTECT</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">PyFloat_FromDouble</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Следует помнить, что все вычисления в вещественных числах делаются компьютером с некоторой ограниченной точностью (см. стандарт <a href="http://www.softelectro.ru/ieee754.html">IEEE-754</a>), поэтому зачастую вместо «честных» ответов получаются приближенные (к этому надо быть готовым), например:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.1</span>
<span class="mf">0.9999999999999999</span>
</code></pre></div>

<p>Если вы не понимаете почему мы не получили единицу, то попробуйте перевести число <span><span class="MathJax_Preview">0.1</span><script type="math/tex">0.1</script></span> в двоичную систему счисления:</p>
<div>
<div class="MathJax_Preview">0.1 = \frac{1}{10} = 0*2^{-1} + 0*2^{-2} + 0*2^{-3} + 1*2^{-4} + 1*2^{-5} + ... = 00011(0011)</div>
<script type="math/tex; mode=display">0.1 = \frac{1}{10} = 0*2^{-1} + 0*2^{-2} + 0*2^{-3} + 1*2^{-4} + 1*2^{-5} + ... = 00011(0011)</script>
</div>
<p>В некоторых случаях на помощь может придти модуль <code>fmath</code>:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">fsum</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">sum</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
<span class="mf">0.9999999999999999</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fsum</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
<span class="mf">1.0</span>
</code></pre></div>

<h3>Представление строк</h3>
<p>Как уже было сказано, строки в Python являются Юникод строками. Для внтуреннего представления строк в Python, начиная с версии 3.3 (см. <a href="https://www.python.org/dev/peps/pep-0393/">PEP-393</a>), используются кодировки Latin-1 (1 байт на символ), UCS-2 (2 байта на символ) и UCS-4 (4 байта на символ). Упрощенно процесс определения кодировки следующий: когда необходимо создать строковый объект (тексты программ обычно в кодировке UTF-8), Python находит самый старший кодовый знак (code point) в строке и выбирает кодироку, в которой кодовый знак может быть представлен «как есть».</p>
<p>Строки представлены не одной структурой, а «иерархией» из трех <a href="https://github.com/python/cpython/blob/3.8/Include/cpython/unicodeobject.h#L88">структур</a>, не считая <code>PyObject</code>. Мы рассмотрим одну структуру - <code>PyASCIIObject</code>, которая содержит большую часть информации о строке, например, какая кодировка используется для хранения строки, длину строки (число кодовых знаков), состоит ли строка только из ASCII-символов, интернирована строка или нет и т.д.</p>
<p>Опишем структуру <code>PyASCIIObject</code> с помощью модуля <code>ctypes</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">ctypes</span>

<span class="k">class</span> <span class="nc">PyASCIIObject</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">Structure</span><span class="p">):</span>
    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;ob_refcnt&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ssize_t</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ob_type&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">py_object</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;length&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ssize_t</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;hash&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ssize_t</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;interned&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;kind&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;compact&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ready&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;wstr&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_wchar_p</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">get_string_kind</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">PyASCIIObject</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">string</span><span class="p">))</span><span class="o">.</span><span class="n">kind</span>
</code></pre></div>

<p>Создадим несколько строковых объектов:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">greet</span> <span class="o">=</span> <span class="s1">&#39;Hello, world&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">greet</span>
<span class="s1">&#39;Hello, world&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">greet</span><span class="p">)</span>
<span class="mi">12</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">greet</span><span class="p">)</span>
<span class="mi">61</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">get_string_kind</span><span class="p">(</span><span class="n">greet</span><span class="p">)</span>
<span class="mi">1</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">greet</span> <span class="o">=</span> <span class="s1">&#39;Hello, 世界&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">greet</span>
<span class="s1">&#39;Hello, 世界&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">greet</span><span class="p">)</span>
<span class="mi">9</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">greet</span><span class="p">)</span>
<span class="mi">92</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">get_string_kind</span><span class="p">(</span><span class="n">greet</span><span class="p">)</span>
<span class="mi">2</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">greet</span> <span class="o">=</span> <span class="s1">&#39;Hello, </span><span class="se">\U0001F30D</span><span class="s1">&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">greet</span>
<span class="s1">&#39;Hello, 🌍&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">greet</span><span class="p">)</span>
<span class="mi">8</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">greet</span><span class="p">)</span>
<span class="mi">108</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">get_string_kind</span><span class="p">(</span><span class="n">greet</span><span class="p">)</span>
<span class="mi">4</span>
</code></pre></div>

<p>Обратите внимание, что хотя длина строк и становится меньше, но занимаемый размер наоборот растет, так как используются разные кодировки для внутреннего представления. Об этом важно помнить, особенно когда вы работаете с большими объемами текстов, так как один символ эмодзи может увеличить занимаемый размер строки в 4 раза.</p>
<p>Почему для внутреннего представления строк не используется UTF-8? Кодировка UTF-8 подразумевает, что может использоваться варьируемое число байт (от одного до четырех) для кодирования одного символа. UTF-8 является оптимальной кодировкой с точки зрения хранения строк (то есть кодировка эффективна по памяти), но при обращении к отдельным элементам строки (при индексировании), необходимо пройтись по всем символам строки пока мы не дойдем до нужного символа. При фиксированном размере такой проблемы не возникает, для перехода к нужной позиции символа достаточно индекс умножить на размер кодового знака (1, 2 или 4 в зависимости от используемой кодировки). Тем не менее есть <a href="http://utf8everywhere.org/">мнение</a>, что индексация это не проблема.</p>
<h3>Интернирование строк</h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Дополнительно про интернирование можно почитать <a href="http://guilload.com/python-string-interning/">тут</a> и <a href="https://rushter.com/blog/python-strings-and-memory/">тут</a>.</p>
</div>
<p>Для экономии памяти в Python реализовано интернирование строк (string interning). Давайте рассмотрим такой пример, пусть у нас есть два строковых объекта с одинаковым содержимым:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">s1</span> <span class="o">=</span> <span class="s2">&quot;foo!&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s2</span> <span class="o">=</span> <span class="s2">&quot;foo!&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s1</span> <span class="ow">is</span> <span class="n">s2</span>
<span class="bp">False</span>
</code></pre></div>

<p>Хотя содержимое строк совпадает это два разных объекта. С другой стороны:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">s1</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s2</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s1</span> <span class="ow">is</span> <span class="n">s2</span>
<span class="bp">True</span>
</code></pre></div>

<p>получим, что адреса <code>s1</code> и <code>s2</code> совпадают. Все строки длиной 0 или 1 интернированы, кроме того интернируются все строковые литералы, состоящие из символов латинского алфавита, цифр или нижнего подчеркивания, также интернируются имена переменных, функций, классов и т.д. </p>
<p>Ниже приведен упрощенный <a href="https://github.com/python/cpython/blob/3.8/Objects/unicodeobject.c#L15264">алгоритм интернирования</a>:</p>
<div class="highlight"><pre><span></span><code><span class="n">interned</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">intern</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">interned</span>

    <span class="k">if</span> <span class="n">string</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span>

    <span class="k">if</span> <span class="n">interned</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">interned</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">interned</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">t</span>

    <span class="n">interned</span><span class="p">[</span><span class="n">string</span><span class="p">]</span> <span class="o">=</span> <span class="n">string</span>
    <span class="k">return</span> <span class="n">string</span>
</code></pre></div>

<p>Если мы хотим интернировать строку, то следует воспользоваться функцией <code>intern</code> из модуля <code>sys</code>:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">sys</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">intern</span><span class="p">(</span><span class="s2">&quot;foo!&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">intern</span><span class="p">(</span><span class="s2">&quot;foo!&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s1</span> <span class="ow">is</span> <span class="n">s2</span>
<span class="bp">True</span>
</code></pre></div>

<p>Использование интернирования строк гарантирует, что не будет создано двух одинаковых строковых объектов. Когда вы создаете второй объект с тем же значением, что и у существующего объекта, то вы получаете ссылку на уже существующий объект. Таким образом, интернирование строк позволяет экономить память и повышает скорость сравнения строк, путем сравнения их адресов (хешей), а не содержимого.</p>
<h2 id="_2">Кортежи</h2>
<p>Последний неизменяемый тип, который мы рассмотрим в этой лекции это кортежи, которые фактически являются статическими массивами, то есть, имеют фиксированный размер, и представлены структурой <a href="https://github.com/python/cpython/blob/3.8/Include/cpython/tupleobject.h#L9"><code>PyTupleObject</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">PyObject_VAR_HEAD</span>
    <span class="cm">/* ob_item contains space for &#39;ob_size&#39; elements.</span>
<span class="cm">       Items must normally not be NULL, except during construction when</span>
<span class="cm">       the tuple is not yet visible outside the function that builds it. */</span>
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">ob_item</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span> <span class="n">PyTupleObject</span><span class="p">;</span>
</code></pre></div>

<p><img alt="image" class="center" src="../../images/lectures/immutable-types/tupleobject.svg" /></p>
<p>Рассмотрим простой пример создания кортежа из трех элементов:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">point</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">point</span>
<span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span>
</code></pre></div>

<p><img alt="image" class="center" src="../../images/lectures/immutable-types/tupleobject2.svg" /></p>
<p>Как уже было отмечено, важной особенностью кортежей является то, что это неизменяемая структура:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="o">...</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="s1">&#39;tuple&#39;</span> <span class="nb">object</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">support</span> <span class="n">item</span> <span class="n">assignment</span>
</code></pre></div>

<p>Когда мы говорим, что кортежи неизменяемые, то имеем ввиду, что мы не можем заменить один элемент кортежа на другой, но сам объект изменить мы можем:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">t</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</code></pre></div>

<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Значительная часть материала про представление целых чисел взята из статьи Артема Голубина: <a href="https://rushter.com/blog/python-integer-implementation/">Python Integer Implementation</a>.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p><a href="http://mortada.net/can-integer-operations-overflow-in-python.html">Can integer operations overflow in Python?</a>.&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
                  
                    

<hr>
<div class="md-source-date">
  <small>
    
      Последнее обновление: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">25 октября 2020 г.</span>
    
  </small>
</div>
                  
                
              
              
                


  <h2 id="__comments">Комментарии</h2>
  <div id="disqus_thread"></div>
  <script>var disqus_config=function(){this.page.url="https://dementiy.github.io/internals/data-types/",this.page.identifier="internals/data-types/"};!function(){var e=document,i=e.createElement("script");i.src="//Dementiy.disqus.com/embed.js",i.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(i)}()</script>

              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 - 2020 <a href="https://github.com/Dementiy" target="_blank" rel="noopener">Dmitrii Sorokin</a>

          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/Dementiy" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.d1f5a259.min.js"></script>
      <script src="../../assets/javascripts/bundle.d5fec882.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440", "clipboard.copied": "\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0435\u0440", "search.config.lang": "ru", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430", "search.result.none": "\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e", "search.result.one": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e 1 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435", "search.result.other": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e # \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ["tabs", "instant"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.fae956e7.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>