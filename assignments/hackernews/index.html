



<!doctype html>
<html lang="ru" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Лекции и практические задания по программированию на Python">
      
      
        <link rel="canonical" href="https://dementiy.github.io/assignments/hackernews/">
      
      
        <meta name="author" content="Sorokin Dmitrii">
      
      
        <meta name="lang:clipboard.copy" content="Копировать в буфер">
      
        <meta name="lang:clipboard.copied" content="Скопировано в буфер">
      
        <meta name="lang:search.language" content="en, ru">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="Совпадений не найдено">
      
        <meta name="lang:search.result.one" content="Найдено 1 совпадение">
      
        <meta name="lang:search.result.other" content="Найдено # совпадений">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Персонализация новостной ленты Hacker News - Программирование на Python</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-111461883-1", "dementiy.github.io")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#_1" tabindex="1" class="md-skip">
        Перейти к содержанию
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://dementiy.github.io/" title="Программирование на Python" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Программирование на Python
            </span>
            <span class="md-header-nav__topic">
              
                Персонализация новостной ленты Hacker News
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Поиск" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Начните печатать для поиска
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/Dementiy/pybook-assignments/" title="Перейти к репозиторию" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../lectures/immutable-types/" title="Лекции" class="md-tabs__link">
          Лекции
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../setup_env/" title="Практические работы" class="md-tabs__link md-tabs__link--active">
          Практические работы
        </a>
      
    </li>
  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../notes/cross-entropy/" title="Заметки" class="md-tabs__link">
          Заметки
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://dementiy.github.io/" title="Программирование на Python" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Программирование на Python
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/Dementiy/pybook-assignments/" title="Перейти к репозиторию" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Лекции
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Лекции
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../lectures/immutable-types/" title="Неизменяемые типы данных" class="md-nav__link">
      Неизменяемые типы данных
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lectures/mutable-types/" title="Изменяемые типы данных" class="md-nav__link">
      Изменяемые типы данных
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lectures/control-statements/" title="Управляющие конструкции" class="md-nav__link">
      Управляющие конструкции
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lectures/functions/" title="Функции" class="md-nav__link">
      Функции
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lectures/ns_and_scopes/" title="Простарнство имен и области видимости" class="md-nav__link">
      Простарнство имен и области видимости
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Жизненный цикл программы" class="md-nav__link">
      Жизненный цикл программы
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lectures/classes/" title="ООП. Классы. Магические методы" class="md-nav__link">
      ООП. Классы. Магические методы
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lectures/descriptors/" title="ООП. Дескрипторы" class="md-nav__link">
      ООП. Дескрипторы
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lectures/attribute_lookup/" title="ООП. Разрешение имен атрибтутов" class="md-nav__link">
      ООП. Разрешение имен атрибтутов
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="ООП. Наследование. Абстрактные классы" class="md-nav__link">
      ООП. Наследование. Абстрактные классы
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lectures/mro/" title="ООП. Порядок разрешения методов" class="md-nav__link">
      ООП. Порядок разрешения методов
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="ООП. Метаклассы" class="md-nav__link">
      ООП. Метаклассы
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Модули и пакеты" class="md-nav__link">
      Модули и пакеты
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lectures/iterators/" title="Итераторы" class="md-nav__link">
      Итераторы
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Генераторы" class="md-nav__link">
      Генераторы
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Конкурентность и параллелизм. Потоки" class="md-nav__link">
      Конкурентность и параллелизм. Потоки
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Конкурентность и параллелизм. Примитивы синхронизации" class="md-nav__link">
      Конкурентность и параллелизм. Примитивы синхронизации
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Конкурентность и параллелизм. Процессы" class="md-nav__link">
      Конкурентность и параллелизм. Процессы
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Конкурентность и параллелизм. Корутины" class="md-nav__link">
      Конкурентность и параллелизм. Корутины
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Управление памятью. Счетчик ссылок" class="md-nav__link">
      Управление памятью. Счетчик ссылок
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Управление памятью. Сборщик мусора" class="md-nav__link">
      Управление памятью. Сборщик мусора
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Практические работы
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Практические работы
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1" checked>
    
    <label class="md-nav__link" for="nav-2-1">
      Basics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        Basics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../setup_env/" title="Настройка рабочего окружения" class="md-nav__link">
      Настройка рабочего окружения
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cypher/" title="Алгоритмы шифрования" class="md-nav__link">
      Алгоритмы шифрования
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sudoku/" title="Решатель Судоку" class="md-nav__link">
      Решатель Судоку
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="С-расширения" class="md-nav__link">
      С-расширения
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../life/" title="Игра «Жизнь»" class="md-nav__link">
      Игра «Жизнь»
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Работа с API ВКонтакте" class="md-nav__link">
      Работа с API ВКонтакте
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Бот для мессенджера Telegram" class="md-nav__link">
      Бот для мессенджера Telegram
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Персонализация новостной ленты Hacker News
      </label>
    
    <a href="./" title="Персонализация новостной ленты Hacker News" class="md-nav__link md-nav__link--active">
      Персонализация новостной ленты Hacker News
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Содержание</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="Сбор данных" class="md-nav__link">
    Сбор данных
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sqlite" title="Сохранение данных в sqlite" class="md-nav__link">
    Сохранение данных в sqlite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" title="Разметка данных" class="md-nav__link">
    Разметка данных
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="Классификация данных" class="md-nav__link">
    Классификация данных
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" title="Пример" class="md-nav__link">
    Пример
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" title="Построение классификатора" class="md-nav__link">
    Построение классификатора
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" title="Вывод ранжированного списка новостей" class="md-nav__link">
    Вывод ранжированного списка новостей
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" title="Комментарии" class="md-nav__link md-nav__link--active">
            Комментарии
          </a>
        </li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Web
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Web
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Приложение для ведения заметок" class="md-nav__link">
      Приложение для ведения заметок
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Простой асинхронный сервер" class="md-nav__link">
      Простой асинхронный сервер
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Простой асинхронный веб-фреймворк" class="md-nav__link">
      Простой асинхронный веб-фреймворк
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Чат на базе веб-сокетов" class="md-nav__link">
      Чат на базе веб-сокетов
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      DataScience
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        DataScience
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../descriptive-statistics/" title="Описательная статистика с Pandas, SQL и R" class="md-nav__link">
      Описательная статистика с Pandas, SQL и R
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Линейная регрессия" class="md-nav__link">
      Линейная регрессия
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Логистическая регрессия" class="md-nav__link">
      Логистическая регрессия
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Деревья. Случайные леса" class="md-nav__link">
      Деревья. Случайные леса
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Кластеризация методом k-средних" class="md-nav__link">
      Кластеризация методом k-средних
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Рекомендательная система кинофильмов и аниме" class="md-nav__link">
      Рекомендательная система кинофильмов и аниме
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="MicroTorch: библиотека для обучения нейронных сетей" class="md-nav__link">
      MicroTorch: библиотека для обучения нейронных сетей
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Заметки
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Заметки
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../notes/cross-entropy/" title="Энтропия и кросс-энтропия" class="md-nav__link">
      Энтропия и кросс-энтропия
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Содержание</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="Сбор данных" class="md-nav__link">
    Сбор данных
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sqlite" title="Сохранение данных в sqlite" class="md-nav__link">
    Сохранение данных в sqlite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" title="Разметка данных" class="md-nav__link">
    Разметка данных
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="Классификация данных" class="md-nav__link">
    Классификация данных
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" title="Пример" class="md-nav__link">
    Пример
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" title="Построение классификатора" class="md-nav__link">
    Построение классификатора
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" title="Вывод ранжированного списка новостей" class="md-nav__link">
    Вывод ранжированного списка новостей
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" title="Комментарии" class="md-nav__link md-nav__link--active">
            Комментарии
          </a>
        </li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/Dementiy/pybook-assignments/edit/master/docs/assignments/hackernews.md" title="Редактировать страницу" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Персонализация новостной ленты Hacker News</h1>
                
                <p>В этой работе вашей задачей является написание простого персонализированного новостного агрегатора.</p>
<p>Для выполнения этого задания вам потребуется собирать и размечать новости из одного или нескольких источников. В качестве поясняющего примера будем использовать социально-новостной сайт <a href="https://news.ycombinator.com">Hacker News</a>.</p>
<h2 id="_1">Сбор данных<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>В предыдущих работах вы уже сталкивались с модулем <code class="codehilite"><span class="n">requests</span></code>, который позволяет отправлять запросы по HTTP-протоколу.
Вспомним, что есть два распространенных типа запросов: <code class="codehilite"><span class="k">GET</span></code> и <code class="codehilite"><span class="n">POST</span></code> (в действительности их гораздо <a href="https://ru.wikipedia.org/wiki/HTTP#.D0.9C.D0.B5.D1.82.D0.BE.D0.B4.D1.8B">больше</a>). 
В запросе типа <code class="codehilite"><span class="k">GET</span></code> информация, передаваемая серверу, расположена в ссылке, которую в случае использования веб-браузера вы можете видеть в адресной строке. 
Например, если вы перейдёте по адресу <a href="https://translate.google.com/?hl=ru#en/ru/python">https://translate.google.com/?hl=ru#en/ru/python</a>, то тем самым вы запросите у сервиса Google Translate перевод слова <em>python</em> с английского языка на русский (параметры запроса указываются после символа <code class="codehilite"><span class="o">?</span></code>).
<code class="codehilite"><span class="n">POST</span></code>-запрос используется в случаях отправки каких-либо форм (авторизация на сайте), больших объемов данных, загрузки файлов на сервер. В таком случае параметры запроса не будут отображаться в адресной строке, а будут расположены в теле запроса. Подробнее о структуре http-запросов можно узнать <a href="https://ru.wikipedia.org/wiki/HTTP#.D0.A1.D1.82.D1.80.D1.83.D0.BA.D1.82.D1.83.D1.80.D0.B0_.D0.BF.D1.80.D0.BE.D1.82.D0.BE.D0.BA.D0.BE.D0.BB.D0.B0">здесь</a></p>
<p>Мы пока будем использовать запросы только типа <code class="codehilite"><span class="k">GET</span></code>.</p>
<p>Давайте выполним два разных <code class="codehilite"><span class="k">GET</span></code>-запроса к новостному сайту:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">requests</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://news.ycombinator.com/newest&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="o">.</span><span class="n">ok</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span>
<span class="mi">200</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://news.ycombinator.com/abrakadabra&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="o">.</span><span class="n">ok</span>
<span class="bp">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span>
<span class="mi">404</span> 
</pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Если у вас не установлен модуль <code class="codehilite"><span class="n">requests</span></code>, то вы можете установить его командой <code class="codehilite"><span class="n">pip</span> <span class="n">install</span> <span class="n">requests</span></code> или <code class="codehilite"><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">requests</span></code>.</p>
</div>
<p>Первый запрос был выполнен успешно, о чем говорит значение <code class="codehilite"><span class="k">True</span></code> свойства <code class="codehilite"><span class="n">r</span><span class="p">.</span><span class="n">ok</span></code> и значение <code class="codehilite"><span class="mi">200</span></code> свойства <code class="codehilite"><span class="n">r</span><span class="p">.</span><span class="n">status_code</span></code>. Возвращаемый код запроса (<code class="codehilite"><span class="n">status_code</span></code>) может содержать много полезной информации о доступности или расположении запрошенного ресурса, о состоянии сервера или возникших в процессе выполнения запроса ошибках. Подробнее о кодах ответов и их значениях можно узнать <a href="https://ru.wikipedia.org/wiki/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D0%BA%D0%BE%D0%B4%D0%BE%D0%B2_%D1%81%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D1%8F_HTTP#.D0.9E.D0.B1.D0.B7.D0.BE.D1.80.D0.BD.D1.8B.D0.B9_.D1.81.D0.BF.D0.B8.D1.81.D0.BE.D0.BA">здесь</a> </p>
<p>Второй запрос был выполнен к несуществующей странице, что привело к ошибке «404 - Не найдено».</p>
<p>Доступ к содержимому страницы можно получить с помощью атрибута <code class="codehilite"><span class="nb">text</span></code> (для примера выведены первые 100 символов):</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span>
<span class="s1">&#39;&lt;html op=&quot;newest&quot;&gt;&lt;head&gt;&lt;meta name=&quot;referrer&quot; content=&quot;origin&quot;&gt;&lt;meta name=&quot;viewport&quot; content=&quot;width=&#39;</span>
</pre></div>

<p>Как вы видите, это простая HTML-страница, из которой нам нужно извлечь интересующую нас информацию, а именно:</p>
<ul>
<li>заголовок новости;</li>
<li>автора новости;</li>
<li>ссылку на новость;</li>
<li>количество комментариев;</li>
<li>количество «лайков», которое набрала статья.</li>
</ul>
<p>Например, в следующей новости:</p>
<p><img alt="" class="center" src="../../images/assignments/hackernews/hn1.png" /></p>
<ul>
<li>заголовок - Show HN: Pydb – a lightweight database with Python syntax queries, using ZeroMQ;</li>
<li>автор - asrp;</li>
<li>ссылка - <a href="https://github.com">https://github.com</a>;</li>
<li>количество комментариев - 11;</li>
<li>количество «лайков» - 63.</li>
</ul>
<p>Для извлечения данных с веб-страниц существует множество разных модулей. Проблема с HTML в том, что большинство браузеров ведет себя «прощающе» относительно страниц, написанных не по стандартам HTML. Впрочем, обработка даже не полностью корректного HTML-кода не так сложна, если под рукой есть подходящие инструменты. Мы будем пользоваться модулем <code class="codehilite"><span class="n">Beautiful</span> <span class="n">Soup</span> <span class="mi">4</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Если у вас не установлен модуль <code class="codehilite"><span class="n">bs4</span></code>, то вы можете установить его командой <code class="codehilite"><span class="n">pip</span> <span class="n">install</span> <span class="n">bs4</span></code> или <code class="codehilite"><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">bs4</span></code>.</p>
</div>
<p>Для использования <code class="codehilite"><span class="n">Beautiful</span> <span class="n">Soup</span></code> нужно передать текст веб-страницы (в виде одной строки) функции <code class="codehilite"><span class="n">BeautifulSoup</span></code>. Чтобы он не "ругался", также следует указывать название парсера (той программы, которая осуществляет обработку HTML). С целью совместимости я использую <code class="codehilite"><span class="n">html</span><span class="p">.</span><span class="n">parser</span></code> (он входит в пакет Python и не требует дополнительной установки), но вы можете также попробовать использовать <code class="codehilite"><span class="n">html5lib</span></code>, если он у вас установлен.</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">page</span>
<span class="o">&lt;</span><span class="n">html</span> <span class="n">op</span><span class="o">=</span><span class="s2">&quot;newest&quot;</span><span class="o">&gt;&lt;</span><span class="n">head</span><span class="o">&gt;&lt;</span><span class="n">meta</span> <span class="n">content</span><span class="o">=</span><span class="s2">&quot;origin&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;referrer&quot;</span><span class="o">&gt;&lt;</span><span class="n">meta</span> <span class="n">content</span><span class="o">=</span><span class="s2">&quot;width=device-width, initial-scal</span>
<span class="n">e</span><span class="o">=</span><span class="mf">1.0</span><span class="s2">&quot; name=&quot;</span><span class="n">viewport</span><span class="s2">&quot;&gt;&lt;link href=&quot;</span><span class="n">news</span><span class="o">.</span><span class="n">css</span><span class="err">?</span><span class="mi">5</span><span class="n">kjS59ufyw5qyqpjcavc</span><span class="s2">&quot; rel=&quot;</span><span class="n">stylesheet</span><span class="s2">&quot; type=&quot;</span><span class="n">text</span><span class="o">/</span><span class="n">css</span><span class="s2">&quot;&gt;</span>
<span class="o">&lt;</span><span class="n">link</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;favicon.ico&quot;</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;shortcut icon&quot;</span><span class="o">&gt;</span>
<span class="o">...</span>
</pre></div>

<p>Перменная <code class="codehilite"><span class="n">page</span></code> представялет собой не просто строковое содержимое HTML-страницы. Это объект, который позволяет в удобной форме обращаться к HTML-тегам.
Например, мы можем обратиться к тегу <code class="codehilite"><span class="n">head</span></code>, а внутри него к тегу <code class="codehilite"><span class="n">title</span></code>:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">page</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">title</span>
<span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">New</span> <span class="n">Links</span> <span class="o">|</span> <span class="n">Hacker</span> <span class="n">News</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">page</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">text</span>
<span class="s1">&#39;New Links | Hacker News&#39;</span>
</pre></div>

<p>Для лучшего понимания структуры HTML-страницы следует воспользоваться веб-инспектором, который есть в большинстве современных браузеров.</p>
<p><img alt="" class="center" src="../../images/assignments/hackernews/hn2.png" /></p>
<p>Если вы посмотрите на структуру HTML-страницы, то сможете заметить, что есть внешняя таблица, которая включает в себя еще три таблицы: заголовок, новостную ленту (которая, в свою очередь, также состоит из множества строк) и подложку (см. рисунок ниже).</p>
<p><img alt="" class="center" src="../../images/assignments/hackernews/hn3.png" /></p>
<p>Возникает вопрос: «Как обратиться к внутренним таблицам?». Если мы дважды обратимся к атрибуту <code class="codehilite"><span class="k">table</span></code>, то получим заголовок:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">page</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">table</span>
<span class="o">&lt;</span><span class="n">table</span> <span class="n">border</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="n">cellpadding</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="n">cellspacing</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;padding:2px&quot;</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="o">&gt;&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">td</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;width:18px;p</span>
<span class="n">adding</span><span class="o">-</span><span class="n">right</span><span class="p">:</span><span class="mi">4</span><span class="n">px</span><span class="s2">&quot;&gt;&lt;a href=&quot;</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">ycombinator</span><span class="o">.</span><span class="n">com</span><span class="s2">&quot;&gt;&lt;img height=&quot;</span><span class="mi">18</span><span class="s2">&quot; src=&quot;</span><span class="n">y18</span><span class="o">.</span><span class="n">gif</span><span class="s2">&quot; style=&quot;</span><span class="n">border</span><span class="p">:</span><span class="mi">1</span><span class="n">px</span> <span class="n">white</span> 
<span class="n">solid</span><span class="p">;</span><span class="s2">&quot; width=&quot;</span><span class="mi">18</span><span class="s2">&quot;/&gt;&lt;/a&gt;&lt;/td&gt;</span>
<span class="o">&lt;</span><span class="n">td</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;line-height:12pt; height:10px;&quot;</span><span class="o">&gt;&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;pagetop&quot;</span><span class="o">&gt;&lt;</span><span class="n">b</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;hnname&quot;</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;news&quot;</span><span class="o">&gt;</span><span class="n">Hacker</span> <span class="n">News</span><span class="o">&lt;</span>
<span class="o">/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">b</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;topsel&quot;</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;newest&quot;</span><span class="o">&gt;</span><span class="n">new</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;newcomments&quot;</span><span class="o">&gt;</span><span class="n">comments</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;show&quot;</span><span class="o">&gt;</span><span class="n">sho</span>
<span class="n">w</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;ask&quot;</span><span class="o">&gt;</span><span class="n">ask</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;jobs&quot;</span><span class="o">&gt;</span><span class="n">jobs</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="o">&gt;</span><span class="n">submit</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;t</span>
<span class="n">ext</span><span class="o">-</span><span class="n">align</span><span class="p">:</span><span class="n">right</span><span class="p">;</span><span class="n">padding</span><span class="o">-</span><span class="n">right</span><span class="p">:</span><span class="mi">4</span><span class="n">px</span><span class="p">;</span><span class="s2">&quot;&gt;&lt;span class=&quot;</span><span class="n">pagetop</span><span class="s2">&quot;&gt;</span>
<span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;login?goto=newest&quot;</span><span class="o">&gt;</span><span class="n">login</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
</pre></div>

<p>У объекта <code class="codehilite"><span class="n">page</span></code> (помимо атрибутов) есть функции, одной из которых является <code class="codehilite"><span class="n">findAll</span></code>, позволяющая найти несколько элементов с одинаковыми тегами:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">tbl_list</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tbl_list</span><span class="p">)</span>
<span class="mi">3</span>
</pre></div>

<p>Соответственно, нулевой элемент списка <code class="codehilite"><span class="n">tbl_list</span></code> это таблица с заголовком, первый элемент списка - таблица с новостями, а второй элемент списка - подложка.</p>
<p>На текущий момент вашей задачей является написать две функции <code class="codehilite"><span class="n">extract_news</span><span class="p">()</span></code> и <code class="codehilite"><span class="n">extract_next_page</span><span class="p">()</span></code>, для корректной работы функции <code class="codehilite"><span class="n">get_news</span><span class="p">()</span></code>, которая в качестве аргументов принимает <code class="codehilite"><span class="n">url</span></code> и <code class="codehilite"><span class="n">n_pages</span></code> (число страниц, с которых необходимо собрать новости), а возвращает список словарей, где каждый словарь представляет собой запись об одной новости (пример вывода смотрите ниже):</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">news_list</span> <span class="o">=</span> <span class="n">get_news</span><span class="p">(</span><span class="s2">&quot;https://news.ycombinator.com/newest&quot;</span><span class="p">,</span> <span class="n">n_pages</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Collecting</span> <span class="n">data</span> <span class="kn">from</span> <span class="nn">page</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">news</span><span class="o">.</span><span class="n">ycombinator</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">newest</span>
<span class="n">Collecting</span> <span class="n">data</span> <span class="kn">from</span> <span class="nn">page</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">news</span><span class="o">.</span><span class="n">ycombinator</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">newest</span><span class="err">?</span><span class="nb">next</span><span class="o">=</span><span class="mi">15852221</span><span class="o">&amp;</span><span class="n">n</span><span class="o">=</span><span class="mi">31</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pp</span><span class="p">(</span><span class="n">news_list</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
<span class="p">[{</span><span class="s1">&#39;author&#39;</span><span class="p">:</span> <span class="s1">&#39;evo_9&#39;</span><span class="p">,</span>
  <span class="s1">&#39;comments&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s1">&#39;points&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Daily Action – Sign Up to Join the Resistance&#39;</span><span class="p">,</span>
  <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;https://dailyaction.org/&#39;</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;author&#39;</span><span class="p">:</span> <span class="s1">&#39;azuajef&#39;</span><span class="p">,</span>
  <span class="s1">&#39;comments&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s1">&#39;points&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Immigration Ban Blocks Travelers at Airports Around Globe&#39;</span><span class="p">,</span>
  <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;https://www.nytimes.com/2017/01/28/us/refugees-detained-at-us-airports-prompting-legal-challenges-to</span>
<span class="o">-</span><span class="n">trumps</span><span class="o">-</span><span class="n">immigration</span><span class="o">-</span><span class="n">order</span><span class="o">.</span><span class="n">html</span><span class="err">?</span><span class="n">_r</span><span class="o">=</span><span class="mi">0</span><span class="s1">&#39;},</span>
 <span class="p">{</span><span class="s1">&#39;author&#39;</span><span class="p">:</span> <span class="s1">&#39;ColinCochrane&#39;</span><span class="p">,</span>
  <span class="s1">&#39;comments&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s1">&#39;points&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
  <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Green card holders included in Trump ban: Homeland Security&#39;</span><span class="p">,</span>
  <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;http://mobile.reuters.com/article/idUSKBN15C0KX&#39;</span><span class="p">}]</span>
</pre></div>

<h2 id="sqlite">Сохранение данных в sqlite<a class="headerlink" href="#sqlite" title="Permanent link">&para;</a></h2>
<p>Собираемые данные нужно где-то хранить. Мы будем использовать для хранения <a href="https://ru.wikipedia.org/wiki/SQLite">SQLite</a> - компактную встраиваемую реляционную базу данных. В стандартной библиотеке языка Python есть модуль <a href="https://docs.python.org/3/library/sqlite3.html">sqlite3</a>, который предоставляет интерфейс для работы с SQLite. Этот модуль требует знания языка SQL, поэтому мы воспользуемся другой технологией, которая называется ORM.</p>
<p>ORM (англ. object-relational mapping, рус. объектно-реляционное отображение) — технология программирования, которая связывает базы данных с концепциями объектно-ориентированных языков программирования, создавая "виртуальную объектную базу данных".</p>
<p><code class="codehilite"><span class="n">SQLAlchemy</span></code> — библиотека на языке Python для работы с <a href="https://ru.wikipedia.org/wiki/%D0%A0%D0%B5%D0%BB%D1%8F%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D0%B0%D1%8F_%D0%B1%D0%B0%D0%B7%D0%B0_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85">реляционными</a> СУБД с применением технологии ORM. Использлуется для синхронизации объектов Python и записей реляционной базы данных. SQLAlchemy позволяет описывать структуры баз данных и способы взаимодействия с ними на языке Python без использования SQL.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Подробную статью по работе с SQLAlchemy можно найти <a href="https://auth0.com/blog/sqlalchemy-orm-tutorial-for-python-developers/">тут</a>.</p>
</div>
<p>Каждая таблица описывается классом, который должен наследоваться от базового класса, создаваемого функцией <code class="codehilite"><span class="n">sqlalchemy</span><span class="p">.</span><span class="n">ext</span><span class="p">.</span><span class="n">declarative</span><span class="p">.</span><span class="n">declarative_base</span><span class="p">()</span></code>.
В рассматриваемом нами примере будет только один класс <code class="codehilite"><span class="n">News</span></code> с следующими атрибутами: заголовок, автор, ссылка, количество комментариев и число лайков.</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Integer</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///news.db&quot;</span><span class="p">)</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">News</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;news&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">comments</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

<span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Обратите внимание на поле <code class="codehilite"><span class="n">label</span></code>, оно нам понадобится в разделе «Разметка данных».</p>
</div>
<p>Функция <code class="codehilite"><span class="n">sqlalchemy</span><span class="p">.</span><span class="n">create_engine</span><span class="p">()</span></code> создает новый экземпляр класса <code class="codehilite"><span class="n">sqlalchemy</span><span class="p">.</span><span class="n">engine</span><span class="p">.</span><span class="n">Engine</span></code>, который отвечает за подключение к базе данных.</p>
<p>Что касается создаваемой сессии, то вот небольшая выдержка о назначении сессиий из официальной документации:</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>In the most general sense, the Session establishes all conversations with the database and represents a «holding zone» for all the objects which you’ve loaded or associated with it during its lifespan. It provides the entrypoint to acquire a Query object, which sends queries to the database using the Session object’s current database connection, populating result rows into objects that are then stored in the Session, inside a structure called the Identity Map - a data structure that maintains unique copies of each object, where «unique» means «only one object with a particular primary key».</p>
<p>The Session begins in an essentially stateless form. Once queries are issued or other objects are persisted with it, it requests a connection resource from an Engine that is associated either with the Session itself or with the mapped Table objects being operated upon. This connection represents an ongoing transaction, which remains in effect until the Session is instructed to commit or roll back its pending state.</p>
<p>All changes to objects maintained by a Session are tracked - before the database is queried again or before the current transaction is committed, it flushes all pending changes to the database. This is known as the Unit of Work pattern.</p>
<p>When using a Session, it’s important to note that the objects which are associated with it are proxy objects to the transaction being held by the Session - there are a variety of events that will cause objects to re-access the database in order to keep synchronized. It is possible to «detach» objects from a Session, and to continue using them, though this practice has its caveats. It’s intended that usually, you’d re-associate detached objects with another Session when you want to work with them again, so that they can resume their normal task of representing database state.</p>
</div>
<p>Более подробно о сессиях можно прочитать <a href="http://docs.sqlalchemy.org/en/latest/orm/session_basics.html">тут</a>.</p>
<p>Далее приведен пример создания объекта и сохранения его в БД:
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="n">session</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">news</span> <span class="o">=</span> <span class="n">News</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Lab 7&#39;</span><span class="p">,</span> 
                <span class="n">author</span><span class="o">=</span><span class="s1">&#39;dementiy&#39;</span><span class="p">,</span>
                <span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://dementiy.gitbooks.io/-python/content/lab7.html&#39;</span><span class="p">,</span>
                <span class="n">comments</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">points</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">news</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">news</span><span class="o">.</span><span class="n">title</span>
<span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">Lab</span> <span class="mi">7</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">news</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">news</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">news</span><span class="o">.</span><span class="n">title</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Lab</span> <span class="mi">7</span><span class="p">)</span>
</pre></div></p>
<p>Обратите внимание, что идентификатор объекта <code class="codehilite"><span class="n">id</span></code> содержит значение <code class="codehilite"><span class="k">None</span></code> до тех пор, пока мы не сделаем коммит этого объекта в БД с помощью метода <code class="codehilite"><span class="k">commit</span><span class="p">()</span></code></p>
<p>На текущий момент вашей задачей является сохранение не менее 1000 записей с новостного сайта в БД (на каждой странице по 30 новостей). Просмотреть содержимое файла <code class="codehilite"><span class="n">news</span><span class="p">.</span><span class="n">db</span></code> можно с помощью программы <a href="http://sqlitebrowser.org">DB Browser for SQLite</a>:</p>
<p><img alt="" class="center" src="../../images/assignments/hackernews/hn4.png" /></p>
<h2 id="_2">Разметка данных<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>Как разметить имеющиеся данные? Давайте создадим простую HTML-страницу, на которой будем выводить список неразмеченных новостей, а рядом с каждой новостью будет несколько кнопок со следующими метками:</p>
<ul>
<li>«Интересно» - эта новость вам показалась интересной, и вы ее прочитали;</li>
<li>«Не интересно» - эта новость вас не интересует;</li>
<li>«Возможно прочитаю» - вы сомневаетесь - интересна вам эта новость или нет.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Меток может быть больше. Кроме того мы можем использовать численное значение для оценки нашего отношения к новости, например, от 0 до 5.</p>
</div>
<p>По нажатию на кнопку должно происходить добавление метки в БД к соответствующей новости и удаления новости из списка неразмеченных новостей, так как мы ее уже разметили.</p>
<p>Для создания такой веб-страницы воспользуемся простым и популярным веб-фреймворком <a href="https://bottlepy.org/docs/dev/">bottle</a>.</p>
<p>Давайте рассмотрим простой пример из документации к этому фреймворку:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">template</span>

<span class="nd">@route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="nd">@route</span><span class="p">(</span><span class="s1">&#39;/hello/&lt;name&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Stranger&quot;</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="s1">&#39;hello_template&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

<span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="c">&lt;!-- hello_template.tpl --&gt;</span>
<span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>Hello {{name}}<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>
</pre></div>

<p>Функция <code class="codehilite"><span class="n">run</span></code> запускает веб-сервер по адресу <code class="codehilite"><span class="n">localhost</span><span class="o">:</span><span class="mi">8080</span></code> (см. скриншоты ниже), обрабатывающий запросы до тех пор, пока вы его не остановите комбинацией <code class="codehilite"><span class="n">Ctrl</span><span class="o">+</span><span class="err">С</span></code>.</p>
<p><img alt="" class="center" src="../../images/assignments/hackernews/hn5.png" /></p>
<p><img alt="" class="center" src="../../images/assignments/hackernews/hn6.png" /></p>
<p><code class="codehilite"><span class="n">route</span></code> это функция-декоратор, которая отвечает за маршрутизацию и связывает адрес ресурса (веб-страницы) с функцией, которая должна быть вызвана при обращении к этому ресурсу.
В нашем примере функция <code class="codehilite"><span class="k">index</span></code> отвечает за два разных маршрута: <code class="codehilite"><span class="o">/</span></code> и <code class="codehilite"><span class="o">/</span><span class="n">hello</span><span class="o">/&lt;</span><span class="n">name</span><span class="o">&gt;</span></code>. Второй маршрут является динамическим, так как он соответствует не одному ресурсу, а целому множеству разных ресурсов: <code class="codehilite"><span class="o">/</span><span class="n">hello</span><span class="o">/</span><span class="n">dementiy</span></code>, <code class="codehilite"><span class="o">/</span><span class="n">hello</span><span class="o">/</span><span class="n">alice</span></code>, <code class="codehilite"><span class="o">/</span><span class="n">hello</span><span class="o">/</span><span class="n">bob</span></code> и т.д.
Шаблон (wildcard) заключается в угловые скобки <code class="codehilite"><span class="o">&lt;</span></code> и <code class="codehilite"><span class="o">&gt;</span></code>, а имя аргумента функции должно совпадать с именем, указанным в шаблоне (в нашем случае это <code class="codehilite"><span class="n">name</span></code>).</p>
<p>В <code class="codehilite"><span class="n">bottle</span></code> реализован механизм шаблонов, предназначенный для генерации веб-страниц. Для начала работы с шаблонизатором достаточно воспользоваться функцией <code class="codehilite"><span class="k">template</span></code>, которая в качестве первого аргумента принимает имя файла, содержащего текст шаблона (в нашем случае это <code class="codehilite"><span class="n">hello_template</span><span class="p">.</span><span class="n">tpl</span></code>). Затем следует список необязательных именованных аргументов, которые нужно передать шаблонизатору (в нашем примере это <code class="codehilite"><span class="n">name</span></code>).</p>
<p>Вернемся к нашему примеру. Напишем функцию, которая будет отвечать за маршрут <code class="codehilite"><span class="n">news</span></code> и выводить список неразмеченных новостей.</p>
<div class="codehilite"><pre><span></span><span class="nd">@route</span><span class="p">(</span><span class="s1">&#39;/news&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">news_list</span><span class="p">():</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">session</span><span class="p">()</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">News</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">News</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="s1">&#39;news_template&#39;</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">rows</span><span class="p">)</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="c">&lt;!-- news_template.tpl --&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.12/semantic.min.css&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">link</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.12/semantic.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;ui container&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;padding-top: 10px;&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;ui celled table&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Title<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Author<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>#Likes<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>#Comments<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">colspan</span><span class="o">=</span><span class="s">&quot;3&quot;</span><span class="p">&gt;</span>Label<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
                %for row in rows:
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ row.url }}&quot;</span><span class="p">&gt;</span>{{ row.title }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ row.author }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ row.points }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ row.comments }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;positive&quot;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/add_label/?label=good&amp;id={{ row.id }}&quot;</span><span class="p">&gt;</span>Интересно<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;active&quot;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/add_label/?label=maybe&amp;id={{ row.id }}&quot;</span><span class="p">&gt;</span>Возможно<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;negative&quot;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/add_label/?label=never&amp;id={{ row.id }}&quot;</span><span class="p">&gt;</span>Не интересно<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                %end
            <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tfoot</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;full-width&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">th</span> <span class="na">colspan</span><span class="o">=</span><span class="s">&quot;7&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/update_news&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;ui right floated small primary button&quot;</span><span class="p">&gt;</span>I Wanna more Hacker News!<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tfoot</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>

<p>Пример таблицы:</p>
<p><img alt="" class="center" src="../../images/assignments/hackernews/hn7.png" /></p>
<p>Обратите внимание на запрос к БД: <code class="codehilite"><span class="n">s</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">News</span><span class="p">).</span><span class="n">filter</span><span class="p">(</span><span class="n">News</span><span class="p">.</span><span class="n">label</span> <span class="o">==</span> <span class="k">None</span><span class="p">).</span><span class="k">all</span><span class="p">()</span></code>:</p>
<ol>
<li>Мы обращаемся к таблице <code class="codehilite"><span class="n">News</span></code> с помощью <code class="codehilite"><span class="n">query</span><span class="p">(</span><span class="n">News</span><span class="p">)</span></code></li>
<li>Фильтруем записи. Нам нужны только те, которые не имеют метки: <code class="codehilite"><span class="n">filter</span><span class="p">(</span><span class="n">News</span><span class="p">.</span><span class="n">label</span> <span class="o">==</span> <span class="k">None</span><span class="p">)</span></code></li>
<li>Все полученные через <code class="codehilite"><span class="k">all</span><span class="p">()</span></code> записи передаем в шаблон</li>
</ol>
<p>В шаблоне мы формируем таблицу со списком неразмеченных новостей. Вы можете заметить, что в шаблоне допустимо использовать управляющие конструкции, такие как цикл <code class="codehilite"><span class="k">for</span></code> (<code class="codehilite"><span class="k">end</span></code> указывает на завершение тела цикла).</p>
<p>И последнее на что стоит обратить внимание: у нас есть три ссылки «Интересно», «Не интересно» и «Возможно». Переход по каждой из которых должен обрабатываться функцией, связанной с маршрутом <code class="codehilite"><span class="n">add_label</span></code>. Также происходит передача двух параметров <code class="codehilite"><span class="n">label</span></code> (нашей метки, со значениями <code class="codehilite"><span class="n">good</span></code>, <code class="codehilite"><span class="n">maybe</span></code>, <code class="codehilite"><span class="n">never</span></code>) и идентификатора новости <code class="codehilite"><span class="n">id</span></code> (вспомним, что каждая новость имеет уникальный числовой идентификатор, который она получает при добавлении в БД).</p>
<p>Вашей задачей является написание функции, которая бы добавляла метку к указанной новости и затем возвращала бы нас на страницу <code class="codehilite"><span class="n">news</span></code>:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">redirect</span>

<span class="nd">@route</span><span class="p">(</span><span class="s1">&#39;/add_label&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_label</span><span class="p">():</span>
    <span class="c1"># 1. Получить значения параметров label и id из GET-запроса</span>
    <span class="c1"># 2. Получить запись из БД с соответствующим id (такая запись только одна!)</span>
    <span class="c1"># 3. Изменить значение метки записи на значение label</span>
    <span class="c1"># 4. Сохранить результат в БД</span>
    <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/news&#39;</span><span class="p">)</span>
</pre></div>

<p>Также напишите функцию, которая бы добавляла свежие новости в БД:</p>
<div class="codehilite"><pre><span></span><span class="nd">@route</span><span class="p">(</span><span class="s1">&#39;/update_news&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">update_news</span><span class="p">():</span>
    <span class="c1"># 1. Получить данные с новостного сайта</span>
    <span class="c1"># 2. Проверить, каких новостей еще нет в БД. Будем считать,</span>
    <span class="c1">#    что каждая новость может быть уникально идентифицирована</span>
    <span class="c1">#    по совокупности двух значений: заголовка и автора</span>
    <span class="c1"># 3. Сохранить в БД те новости, которых там нет</span>
    <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/news&#39;</span><span class="p">)</span>
</pre></div>

<h2 id="_3">Классификация данных<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>В этом разделе вашей задачей является написание простого классификатора, который бы выводил неразмеченные новости в следующем порядке: сначала идут интересные для нас новости, затем те, которые мы бы возможно прочитали, и в конце  - неинтересные новости.</p>
<p>Итак, у нас есть корпус, состоящий из размеченных и неразмеченных документов (новостей). Возникает два вопроса: «Каким образом каждой свежей новости присвоить одну из меток (классов)?» и «Как оценить нашу классификацию?».</p>
<p>Для более качественной классификации мы будем использовать <strong>наивный байесовский классификатор</strong>. Если вы не знакомы с теоремой Байеса, то можете прочитать исчерпывающее объяснение от <a href="http://yudkowsky.net/rational/bayes">Юдковски</a> (есть перевод и на русский язык). Также, для пояснения работы наивного байесовского классификатора я буду ссылаться на статью в <a href="https://en.wikipedia.org/wiki/Naive_Bayes_classifier">Википедии</a>.</p>
<p>Итак, вопрос на который мы отвечаем: «Какова вероятность, что документ <span><span class="MathJax_Preview">D</span><script type="math/tex">D</script></span> принадлежит классу <span><span class="MathJax_Preview">C</span><script type="math/tex">C</script></span>?» или в более строгой записи: чему равно <span><span class="MathJax_Preview">P(D \mid C)</span><script type="math/tex">P(D \mid C)</script></span>? Документом <span><span class="MathJax_Preview">D</span><script type="math/tex">D</script></span> у нас является новость, а классом <span><span class="MathJax_Preview">C</span><script type="math/tex">C</script></span> - одна из трех возможных меток: «Интересно», «Не интересно», «Возможно».</p>
<p>Документ представляется множеством независимых слов (это лишь предположение, которого мы придерживаемся. В действительности слова не являются независимыми, например, слово «Петербург» имеет более высокую вероятность идти в паре со словом «Санкт»), где вероятность того, что <span><span class="MathJax_Preview">i</span><script type="math/tex">i</script></span>-ое слово данного документа принадлежит классу <span><span class="MathJax_Preview">C</span><script type="math/tex">C</script></span> равна <span><span class="MathJax_Preview">P(w_i \mid C)</span><script type="math/tex">P(w_i \mid C)</script></span>. Таким образом, вероятность для данного документа и класса <span><span class="MathJax_Preview">C</span><script type="math/tex">C</script></span> равна: </p>
<div>
<div class="MathJax_Preview">P(D|C) = \prod_{i} P(w_i|C)</div>
<script type="math/tex; mode=display">P(D|C) = \prod_{i} P(w_i|C)</script>
</div>
<p>По теореме Байеса получим:</p>
<div>
<div class="MathJax_Preview">P(C|D) = \frac{P(C)P(D|C)}{P(D)}</div>
<script type="math/tex; mode=display">P(C|D) = \frac{P(C)P(D|C)}{P(D)}</script>
</div>
<p>Можно заметить, что знаменатель не зависит от <span><span class="MathJax_Preview">C</span><script type="math/tex">C</script></span>, поэтому получим:</p>
<div>
<div class="MathJax_Preview">P(C|D) \propto P(C)P(D|C) = P(C)\prod_{i}P(w_i|C)</div>
<script type="math/tex; mode=display">P(C|D) \propto P(C)P(D|C) = P(C)\prod_{i}P(w_i|C)</script>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Хотя с точки зрения теории вероятностей эта формула неверная, так как сумма вероятностей не будет равна 1, но с точки зрения работы классификатора она нас полностью устраивает.</p>
</div>
<p>Вы можете догадаться, что если появится слово, которого мы раньше не встречали, то <span><span class="MathJax_Preview">\prod_{i}P(w_i \mid C) = 0</span><script type="math/tex">\prod_{i}P(w_i \mid C) = 0</script></span>, а следовательно и <span><span class="MathJax_Preview">P(C \mid D) = 0</span><script type="math/tex">P(C \mid D) = 0</script></span>.</p>
<p>Одним из типичных решений является использование Lidstone smoothing (<span><span class="MathJax_Preview">\alpha &lt; 1</span><script type="math/tex">\alpha < 1</script></span>) или Laplacian smoothing (<span><span class="MathJax_Preview">\alpha = 1</span><script type="math/tex">\alpha = 1</script></span>):</p>
<div>
<div class="MathJax_Preview">P(w_i \mid C = c) = \frac{n_{i,c} + \alpha}{n_c + \alpha d}</div>
<script type="math/tex; mode=display">P(w_i \mid C = c) = \frac{n_{i,c} + \alpha}{n_c + \alpha d}</script>
</div>
<p>где:</p>
<ul>
<li><span><span class="MathJax_Preview">n_{i,c}</span><script type="math/tex">n_{i,c}</script></span> - число наблюдений признака <span><span class="MathJax_Preview">w_i</span><script type="math/tex">w_i</script></span> для класса <span><span class="MathJax_Preview">c</span><script type="math/tex">c</script></span>;</li>
<li><span><span class="MathJax_Preview">n_c</span><script type="math/tex">n_c</script></span> - число наблюдений признака <span><span class="MathJax_Preview">w_i</span><script type="math/tex">w_i</script></span> среди всех классов;</li>
<li><span><span class="MathJax_Preview">\alpha</span><script type="math/tex">\alpha</script></span> - параметр сглаживания;</li>
<li><span><span class="MathJax_Preview">d</span><script type="math/tex">d</script></span> - размерность вектора признаков <span><span class="MathJax_Preview">W = \left \langle w_1,...,w_d \right \rangle</span><script type="math/tex">W = \left \langle w_1,...,w_d \right \rangle</script></span>.</li>
</ul>
<p>Еще одним «техническим» трюком является логарифмирование, чтобы произведение маленьких величин не привело к обращению всего произведения в ноль:</p>
<div>
<div class="MathJax_Preview">\ln P(C|D) \propto \ln P(C) + \sum_i \ln P(w_i|C)</div>
<script type="math/tex; mode=display">\ln P(C|D) \propto \ln P(C) + \sum_i \ln P(w_i|C)</script>
</div>
<p>Итак, наша итоговая модель будет выглядеть следующим образом:</p>
<div>
<div class="MathJax_Preview">\hat{y} = argmax_c\Big(\ln P(C=c) + \sum_i \ln P(w_i|C = c) \Big)</div>
<script type="math/tex; mode=display">\hat{y} = argmax_c\Big(\ln P(C=c) + \sum_i \ln P(w_i|C = c) \Big)</script>
</div>
<h3 id="_4">Пример<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>Давайте рассмотрим простой пример классификации сообщений с двумя классами «Positive» и «Negative». Пусть у нас имеется следующая обучающая выборка:</p>
<table>
<thead>
<tr>
<th>Сообщение</th>
<th>Метка класса</th>
</tr>
</thead>
<tbody>
<tr>
<td>I love this sandwich</td>
<td>Positive</td>
</tr>
<tr>
<td>This is an amazing place</td>
<td>Positive</td>
</tr>
<tr>
<td>I feel very good about these beers</td>
<td>Positive</td>
</tr>
<tr>
<td>This is my best work</td>
<td>Positive</td>
</tr>
<tr>
<td>What an awesome view</td>
<td>Positive</td>
</tr>
<tr>
<td>I do not like this restaurant</td>
<td>Negative</td>
</tr>
<tr>
<td>I am tired of this stuff</td>
<td>Negative</td>
</tr>
<tr>
<td>I can't deal with this</td>
<td>Negative</td>
</tr>
<tr>
<td>He is my sworn enemy</td>
<td>Negative</td>
</tr>
<tr>
<td>My boss is horrible</td>
<td>Negative</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Данные для примера можно найти <a href="https://stevenloria.com/simple-text-classification/">тут</a>.</p>
</div>
<p>Для начала найдем априорные вероятности классов: <span><span class="MathJax_Preview">P(C=pos) = 5/10 = 0.5</span><script type="math/tex">P(C=pos) = 5/10 = 0.5</script></span> и <span><span class="MathJax_Preview">P(C=neg) = 5/10 = 0.5</span><script type="math/tex">P(C=neg) = 5/10 = 0.5</script></span>.</p>
<p>Теперь составим таблицу, в которой будут следующие колонки (о двух дополнительных колонках см. ниже):</p>
<ul>
<li>слова из обучающей выборки;</li>
<li>сколько раз слово встретилось в классе «Positive»;</li>
<li>сколько раз слово встретилось в классе «Negative».</li>
</ul>
<table>
<thead>
<tr>
<th>Слово</th>
<th>«<span><span class="MathJax_Preview">+</span><script type="math/tex">+</script></span>»</th>
<th>«<span><span class="MathJax_Preview">-</span><script type="math/tex">-</script></span>»</th>
<th><span><span class="MathJax_Preview">P(w_i \mid pos)</span><script type="math/tex">P(w_i \mid pos)</script></span></th>
<th><span><span class="MathJax_Preview">P(w_i \mid neg)</span><script type="math/tex">P(w_i \mid neg)</script></span></th>
</tr>
</thead>
<tbody>
<tr>
<td>about</td>
<td>1</td>
<td>0</td>
<td>0.032</td>
<td>0.016</td>
</tr>
<tr>
<td>am</td>
<td>0</td>
<td>1</td>
<td>0.016</td>
<td>0.032</td>
</tr>
<tr>
<td>amazing</td>
<td>1</td>
<td>0</td>
<td>0.032</td>
<td>0.016</td>
</tr>
<tr>
<td>an</td>
<td>2</td>
<td>0</td>
<td>0.049</td>
<td>0.016</td>
</tr>
<tr>
<td>awesome</td>
<td>1</td>
<td>0</td>
<td>0.032</td>
<td>0.016</td>
</tr>
<tr>
<td>beers</td>
<td>1</td>
<td>0</td>
<td>0.032</td>
<td>0.016</td>
</tr>
<tr>
<td>best</td>
<td>1</td>
<td>0</td>
<td>0.032</td>
<td>0.016</td>
</tr>
<tr>
<td>boss</td>
<td>0</td>
<td>1</td>
<td>0.016</td>
<td>0.032</td>
</tr>
<tr>
<td>cant</td>
<td>0</td>
<td>1</td>
<td>0.016</td>
<td>0.032</td>
</tr>
<tr>
<td>deal</td>
<td>0</td>
<td>1</td>
<td>0.016</td>
<td>0.032</td>
</tr>
<tr>
<td>do</td>
<td>0</td>
<td>1</td>
<td>0.016</td>
<td>0.032</td>
</tr>
<tr>
<td>enemy</td>
<td>0</td>
<td>1</td>
<td>0.016</td>
<td>0.032</td>
</tr>
<tr>
<td>feel</td>
<td>1</td>
<td>0</td>
<td>0.032</td>
<td>0.016</td>
</tr>
<tr>
<td>good</td>
<td>1</td>
<td>0</td>
<td>0.032</td>
<td>0.016</td>
</tr>
<tr>
<td>he</td>
<td>0</td>
<td>1</td>
<td>0.016</td>
<td>0.032</td>
</tr>
<tr>
<td>horrible</td>
<td>0</td>
<td>1</td>
<td>0.016</td>
<td>0.032</td>
</tr>
<tr>
<td>i</td>
<td>2</td>
<td>3</td>
<td>0.049</td>
<td>0.064</td>
</tr>
<tr>
<td>is</td>
<td>2</td>
<td>2</td>
<td>0.049</td>
<td>0.048</td>
</tr>
<tr>
<td>like</td>
<td>0</td>
<td>1</td>
<td>0.016</td>
<td>0.032</td>
</tr>
<tr>
<td>love</td>
<td>1</td>
<td>0</td>
<td>0.032</td>
<td>0.016</td>
</tr>
<tr>
<td>my</td>
<td>1</td>
<td>2</td>
<td>0.032</td>
<td>0.048</td>
</tr>
<tr>
<td>not</td>
<td>0</td>
<td>1</td>
<td>0.016</td>
<td>0.032</td>
</tr>
<tr>
<td>of</td>
<td>0</td>
<td>1</td>
<td>0.016</td>
<td>0.032</td>
</tr>
<tr>
<td>place</td>
<td>1</td>
<td>0</td>
<td>0.032</td>
<td>0.016</td>
</tr>
<tr>
<td>restaurant</td>
<td>0</td>
<td>1</td>
<td>0.016</td>
<td>0.032</td>
</tr>
<tr>
<td>sandwich</td>
<td>1</td>
<td>0</td>
<td>0.032</td>
<td>0.016</td>
</tr>
<tr>
<td>stuff</td>
<td>0</td>
<td>1</td>
<td>0.016</td>
<td>0.032</td>
</tr>
<tr>
<td>sworn</td>
<td>0</td>
<td>1</td>
<td>0.016</td>
<td>0.032</td>
</tr>
<tr>
<td>these</td>
<td>1</td>
<td>0</td>
<td>0.032</td>
<td>0.016</td>
</tr>
<tr>
<td>this</td>
<td>3</td>
<td>3</td>
<td>0.065</td>
<td>0.064</td>
</tr>
<tr>
<td>tired</td>
<td>0</td>
<td>1</td>
<td>0.016</td>
<td>0.032</td>
</tr>
<tr>
<td>very</td>
<td>1</td>
<td>0</td>
<td>0.032</td>
<td>0.016</td>
</tr>
<tr>
<td>view</td>
<td>1</td>
<td>0</td>
<td>0.032</td>
<td>0.016</td>
</tr>
<tr>
<td>what</td>
<td>1</td>
<td>0</td>
<td>0.032</td>
<td>0.016</td>
</tr>
<tr>
<td>with</td>
<td>0</td>
<td>1</td>
<td>0.016</td>
<td>0.032</td>
</tr>
<tr>
<td>work</td>
<td>1</td>
<td>0</td>
<td>0.032</td>
<td>0.016</td>
</tr>
</tbody>
</table>
<p>Итак, размер вектора признаков равен <span><span class="MathJax_Preview">d=36</span><script type="math/tex">d=36</script></span> (число уникальных слов во всей выборке). Также найдем число слов относящихся  к классу «Positive» и к классу «Negative»: <span><span class="MathJax_Preview">n_{pos} = 25</span><script type="math/tex">n_{pos} = 25</script></span> и <span><span class="MathJax_Preview">n_{neg} = 26</span><script type="math/tex">n_{neg} = 26</script></span> (суммы по второму и третьему столбцу). Теперь мы можем посчитать вероятность встретить слово в каждом из классов <span><span class="MathJax_Preview">P(w_i \mid C = c)</span><script type="math/tex">P(w_i \mid C = c)</script></span> (4 и 5 столбцы).</p>
<p>Нам этого достаточно для того, чтобы классифицировать новые сообщения. Пусть имеется такой набор тестовых данных:</p>
<table>
<thead>
<tr>
<th>Сообщение</th>
<th>Метка класса</th>
</tr>
</thead>
<tbody>
<tr>
<td>The beer was good</td>
<td>Positive</td>
</tr>
<tr>
<td>I do not enjoy my job</td>
<td>Negative</td>
</tr>
<tr>
<td>I ain't feeling dandy today</td>
<td>Negative</td>
</tr>
<tr>
<td>I feel amazing</td>
<td>Positive</td>
</tr>
<tr>
<td>Gary is a friend of mine</td>
<td>Positive</td>
</tr>
<tr>
<td>I can't believe I'm doing this</td>
<td>Negative</td>
</tr>
</tbody>
</table>
<p>В качестве примера рассмотрим классификацию первого сообщения.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Если слова нет в словаре, то есть, среди всех слов из обучающей выборки, то оно никак не повлияет на результат классификации. Таким образом, будем считать его вероятность для обоих классов равной нулю.</p>
</div>
<div>
<div class="MathJax_Preview">
\begin{aligned}
\ln P(pos|D) &amp;= \ln P(pos) + \ln P(the|pos) + \ln P(beer|pos) + \ln P(was|pos) + \ln P(good|pos) \\ 
&amp;= -0.693 + 0 + 0 + 0 - 3.417 = -4.110 \\
\ln P(neg|D) &amp;= \ln P(neg) + \ln P(the|neg) + \ln P(beer|neg) + \ln P(was|neg) + \ln P(good|neg) \\
&amp;= -0.693 - 0 + 0 + 0 - 4.127 = -4.820 \\
\hat{y} &amp;= argmax_c\Big(\ln P(pos|D), \ln P(neg|D)\Big) = \ln P(pos|D) \Rightarrow pos
\end{aligned}
</div>
<script type="math/tex; mode=display">
\begin{aligned}
\ln P(pos|D) &= \ln P(pos) + \ln P(the|pos) + \ln P(beer|pos) + \ln P(was|pos) + \ln P(good|pos) \\ 
&= -0.693 + 0 + 0 + 0 - 3.417 = -4.110 \\
\ln P(neg|D) &= \ln P(neg) + \ln P(the|neg) + \ln P(beer|neg) + \ln P(was|neg) + \ln P(good|neg) \\
&= -0.693 - 0 + 0 + 0 - 4.127 = -4.820 \\
\hat{y} &= argmax_c\Big(\ln P(pos|D), \ln P(neg|D)\Big) = \ln P(pos|D) \Rightarrow pos
\end{aligned}
</script>
</div>
<p>Если мы классифицируем остальные сообщения, то получим, что мы верно классифицировали 5 из 6 сообщений. Таким образом, точность нашего классификатора составила 83% на тестовой выборке.</p>
<h3 id="_5">Построение классификатора<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>Вашей задачей является написать наивный байесовский классификатор:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">NaiveBayesClassifier</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Fit Naive Bayes classifier according to X, y. &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Perform classification on an array of test vectors X. &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the mean accuracy on the given test data and labels. &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre></div>

<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Вы можете использовать <code class="codehilite"><span class="n">Counter</span></code> и <code class="codehilite"><span class="n">defaultdict</span></code> из модуля <code class="codehilite"><span class="n">collections</span></code>, чтобы хранить вероятности классов и слов, соответственно.</p>
</div>
<p>Для проверки классификатора воспользуемся датасетом содержащим смс сообщения относящиеся к одному из двух классов: спам (spam) и не спам (ham). Описание набора данных можно найти <a href="https://archive.ics.uci.edu/ml/datasets/sms+spam+collection">тут</a>, а сам датасет есть в репозитории.</p>
<p>Для начала загрузим данные с помощью модуля <code class="codehilite"><span class="n">csv</span></code> и посмотрим на первые три записи:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">csv</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;SMSSpamCollection&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="mi">5572</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<span class="p">[[</span><span class="s1">&#39;ham&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Go until jurong point, crazy.. Available only in bugis n great world la e &#39;</span>
  <span class="s1">&#39;buffet... Cine there got amore wat...&#39;</span><span class="p">],</span>
 <span class="p">[</span><span class="s1">&#39;ham&#39;</span><span class="p">,</span> <span class="s1">&#39;Ok lar... Joking wif u oni...&#39;</span><span class="p">],</span>
 <span class="p">[</span><span class="s1">&#39;spam&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005. Text FA &#39;</span>
  <span class="s2">&quot;to 87121 to receive entry question(std txt rate)T&amp;C&#39;s apply &quot;</span>
  <span class="s2">&quot;08452810075over18&#39;s&quot;</span><span class="p">]]</span>
</pre></div>

<p>Приведем все сообщения к нижнему регистру и избавимся от символов пунктуации:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">string</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="n">translator</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">translator</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="n">clean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">X</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">X</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<span class="p">[</span><span class="s1">&#39;go until jurong point crazy available only in bugis n great world la e buffet cine there got amore wat&#39;</span><span class="p">,</span> <span class="s1">&#39;ok lar joking wif u oni&#39;</span><span class="p">,</span> <span class="s1">&#39;free entry in 2 a wkly comp to win fa cup final tkts 21st may 2005 text fa to 87121 to receive entry questionstd txt ratetcs apply 08452810075over18s&#39;</span><span class="p">]</span>
</pre></div>

<p>Разобьем набор данных на обучабщую и тестовую выборки в соотношении 70%/30%. Обучающая выборка используется для построения модели (обучения классификатора), а тестовая выборка для оценки работы классификатора на новых данных (притворимся, что 30% данных мы раньше не видели):</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="mi">3900</span><span class="p">],</span> <span class="n">y</span><span class="p">[:</span><span class="mi">3900</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="mi">3900</span><span class="p">:],</span> <span class="n">y</span><span class="p">[</span><span class="mi">3900</span><span class="p">:]</span>
</pre></div>

<p>Теперь построим модель классификатора и оценим ее работу:</p>
<div class="codehilite"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">NaiveBayesClassifier</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))</span>
<span class="c1"># 0.9820574162679426</span>
</pre></div>

<p>Сравним результаты с классификатором <a href="http://scikit-learn.org/stable/modules/generated/sklearn.naive_bayes.MultinomialNB.html#sklearn.naive_bayes.MultinomialNB">MultinomialNB</a> из библиотеки <code class="codehilite"><span class="n">sklearn</span></code>:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">MultinomialNB</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">TfidfVectorizer</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;vectorizer&#39;</span><span class="p">,</span> <span class="n">TfidfVectorizer</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">MultinomialNB</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)),</span>
<span class="p">])</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))</span>
<span class="c1"># 0.982057416268</span>
</pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Для построения хорошей модели может быть не достаточно удалить символы пунктуации и привести весь текст к нижнему регистру. Попробуйте провести лематизацию или стемминг, исопльзовать n-граммы, учитывать домен и автора статьи. О работе с текстом можно почитать <a href="https://github.com/mephistopheies/mlworkshop39_042017/blob/master/2_nlp/Text_preprocessing.ipynb">тут</a>.</p>
</div>
<p>Мы получили в точности тоже значение, что говорит нам о правильности работы нашего классификатора. Ваша задача теперь построить и оценить модель на собранных и размеченных ранее данных с новостного сайта HackerNews.</p>
<h3 id="_6">Вывод ранжированного списка новостей<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>Добавьте обработчик запроса для вывода ранжированной таблицы новостей:</p>
<div class="codehilite"><pre><span></span><span class="nd">@route</span><span class="p">(</span><span class="s1">&#39;/recommendations&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">recommendations</span><span class="p">():</span>
    <span class="c1"># 1. Получить список неразмеченных новостей из БД</span>
    <span class="c1"># 2. Получить прогнозы для каждой новости</span>
    <span class="c1"># 3. Вывести ранжированную таблицу с новостями</span>
    <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="s1">&#39;news_recommendations&#39;</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">classified_news</span><span class="p">)</span>
</pre></div>
                
                  
                
              
              
                


  <h2 id="__comments">Комментарии</h2>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = "https://dementiy.github.io/assignments/hackernews/";
      this.page.identifier =
        "assignments/hackernews/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//Dementiy.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>

              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../life/" title="Игра «Жизнь»" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Назад
                </span>
                Игра «Жизнь»
              </span>
            </div>
          </a>
        
        
          <a href="../descriptive-statistics/" title="Описательная статистика с Pandas, SQL и R" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Вперед
                </span>
                Описательная статистика с Pandas, SQL и R
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/Dementiy" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.245445c6.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
          
            
              
              
                <script src="../../assets/javascripts/lunr/lunr.ru.js"></script>
              
            
          
          
            <script src="../../assets/javascripts/lunr/lunr.multi.js"></script>
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>