


<!doctype html>
<html lang="ru" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Лекции и практические задания по программированию на Python">
      
      
        <link rel="canonical" href="https://dementiy.github.io/lectures/control-statements/">
      
      
        <meta name="author" content="Sorokin Dmitrii">
      
      <link rel="shortcut icon" href="../../images/kitano.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.6">
    
    
      
        <title>Управляющие конструкции - Программирование на Python</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.63b94e9e.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.7f672a1f.min.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-111461883-1","dementiy.github.io"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview",document.location.pathname)})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Перейти к содержанию
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://dementiy.github.io/" title="Программирование на Python" class="md-header-nav__button md-logo" aria-label="Программирование на Python">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Программирование на Python
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Управляющие конструкции
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Поиск" placeholder="Поиск" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/Dementiy/pybook-assignments/" title="Перейти к репозиторию" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Dementiy/pybook-assignments
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../immutable-types/" class="md-tabs__link md-tabs__link--active">
          Лекции
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../assignments/setup_env/" class="md-tabs__link">
          Практические работы
        </a>
      
    </li>
  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../notes/cross-entropy/" class="md-tabs__link">
          Заметки
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://dementiy.github.io/" title="Программирование на Python" class="md-nav__button md-logo" aria-label="Программирование на Python">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Программирование на Python
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/Dementiy/pybook-assignments/" title="Перейти к репозиторию" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Dementiy/pybook-assignments
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1" checked>
    
    <label class="md-nav__link" for="nav-1">
      Лекции
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Лекции" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Лекции
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../immutable-types/" title="Неизменяемые типы данных" class="md-nav__link">
      Неизменяемые типы данных
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mutable-types/" title="Изменяемые типы данных" class="md-nav__link">
      Изменяемые типы данных
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Управляющие конструкции
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Управляющие конструкции" class="md-nav__link md-nav__link--active">
      Управляющие конструкции
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    Условия
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    Продолжая говорить об условиях
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    Циклы
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    Исключения
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../functions/" title="Функции" class="md-nav__link">
      Функции
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ns_and_scopes/" title="Пространство имен и области видимости" class="md-nav__link">
      Пространство имен и области видимости
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../classes/" title="ООП. Классы. Магические методы" class="md-nav__link">
      ООП. Классы. Магические методы
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../descriptors/" title="ООП. Дескрипторы" class="md-nav__link">
      ООП. Дескрипторы
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../attribute_lookup/" title="ООП. Разрешение имен атрибтутов" class="md-nav__link">
      ООП. Разрешение имен атрибтутов
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mro/" title="ООП. Порядок разрешения методов" class="md-nav__link">
      ООП. Порядок разрешения методов
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../iterators/" title="Итераторы" class="md-nav__link">
      Итераторы
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Практические работы
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Практические работы" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Практические работы
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      Basics
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Basics" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Basics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../assignments/setup_env/" title="Настройка рабочего окружения" class="md-nav__link">
      Настройка рабочего окружения
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../assignments/cypher/" title="Алгоритмы шифрования" class="md-nav__link">
      Алгоритмы шифрования
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../assignments/sudoku/" title="Решатель Судоку" class="md-nav__link">
      Решатель Судоку
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../assignments/life/" title="Игра «Жизнь»" class="md-nav__link">
      Игра «Жизнь»
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../assignments/pyvcs/" title="PyVCS. Распределенная система контроля версий" class="md-nav__link">
      PyVCS. Распределенная система контроля версий
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../assignments/vk_api/" title="Работа с API ВКонтакте" class="md-nav__link">
      Работа с API ВКонтакте
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../assignments/hackernews/" title="Персонализация новостной ленты Hacker News" class="md-nav__link">
      Персонализация новостной ленты Hacker News
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      DataScience
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="DataScience" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        DataScience
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../assignments/descriptive-statistics/" title="Описательная статистика с Pandas, SQL и R" class="md-nav__link">
      Описательная статистика с Pandas, SQL и R
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Заметки
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Заметки" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Заметки
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../notes/cross-entropy/" title="Энтропия и кросс-энтропия" class="md-nav__link">
      Энтропия и кросс-энтропия
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../notes/regression/" title="Линейная регрессия" class="md-nav__link">
      Линейная регрессия
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    Условия
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    Продолжая говорить об условиях
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    Циклы
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    Исключения
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                  <h1>Управляющие конструкции</h1>
                
                <p>Во третьей лекции мы рассмотрим основные управляющие конструкции языка, такие как условия, циклы и исключения. Также в этой лекции будет наше первое знакомство с виртуальной машиной Python.</p>
<h2 id="_1">Условия</h2>
<p>Для проверки условий и выполнения соотвествующих инструкций используется конструкция <code>if-elif-else</code> со следующим синтаксисом:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="n">something1</span><span class="p">:</span>
    <span class="n">do1</span><span class="p">()</span>
<span class="k">elif</span> <span class="n">something2</span><span class="p">:</span>
    <span class="n">do2</span><span class="p">()</span>
<span class="k">elif</span> <span class="n">something3</span><span class="p">:</span>
    <span class="n">do3</span><span class="p">()</span>
<span class="c1"># ...</span>
<span class="k">elif</span> <span class="n">somethingN</span><span class="p">:</span>
    <span class="n">doN</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">do_something_else</span><span class="p">()</span>
</code></pre></div>

<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>В Python, в отличие от других языков программирования, тело некоторого блока (условия, цикла, функции, класса) обозначается отступами.</p>
</div>
<p>Давайте рассмотрим пример тела (содержимого) простой функции, используемой в качестве функции активации в нейронных сетях - <a href="https://en.wikipedia.org/wiki/Rectifier_(neural_networks)">ReLU</a> (Rectified Linear Units), которая возвращает положительное или нулевое значение аргумента:</p>
<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="mf">0.4</span>    <span class="c1"># 1</span>
<span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># 2</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># 3</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span>  <span class="c1"># 5</span>
<span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>   <span class="c1"># 6</span>
</code></pre></div>

<p>Условная конструкция получилась достаточно простой и очевидной, поэтому мы вкратце разберем то, как Python будет «интерпретировать» эти 6 строк кода.</p>
<p>Интерпретация, в простом понимании, означает чтение файла с исходным кодом вашей программы и поэтапное ее выполнение. В Python этапу интерпретации предшествует этап компиляции, то есть, исходный код ваших программ компилируется в <a href="https://ru.wikipedia.org/wiki/%D0%91%D0%B0%D0%B9%D1%82-%D0%BA%D0%BE%D0%B4">байт-код</a> или другими словами в набор простых инструкций, чем-то напоминающих инструкции CPU, которые и будут выполняться (интерпретироваться) виртуальной машиной Python (в одной из следующих лекций мы будем говорить о том откуда берутся эти инструкции). Давайте посмотрим как выглядит байт-код для приведенного выше примера с помощью модуля <a href="https://docs.python.org/3/library/dis.html">dis</a> из стандартной библиотеки:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">dis</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;...&quot;&quot;&quot;</span><span class="p">)</span>
  <span class="mi">1</span>           <span class="mi">0</span> <span class="n">LOAD_CONST</span>               <span class="mi">0</span> <span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>
              <span class="mi">2</span> <span class="n">STORE_NAME</span>               <span class="mi">0</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>

  <span class="mi">2</span>           <span class="mi">4</span> <span class="n">LOAD_NAME</span>                <span class="mi">0</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
              <span class="mi">6</span> <span class="n">LOAD_CONST</span>               <span class="mi">1</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
              <span class="mi">8</span> <span class="n">COMPARE_OP</span>               <span class="mi">1</span> <span class="p">(</span><span class="o">&lt;=</span><span class="p">)</span>
             <span class="mi">10</span> <span class="n">POP_JUMP_IF_FALSE</span>       <span class="mi">18</span>

  <span class="mi">3</span>          <span class="mi">12</span> <span class="n">LOAD_CONST</span>               <span class="mi">1</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
             <span class="mi">14</span> <span class="n">STORE_NAME</span>               <span class="mi">0</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
             <span class="mi">16</span> <span class="n">JUMP_FORWARD</span>             <span class="mi">4</span> <span class="p">(</span><span class="n">to</span> <span class="mi">22</span><span class="p">)</span>

  <span class="mi">5</span>     <span class="o">&gt;&gt;</span>   <span class="mi">18</span> <span class="n">LOAD_NAME</span>                <span class="mi">0</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
             <span class="mi">20</span> <span class="n">STORE_NAME</span>               <span class="mi">0</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>

  <span class="mi">6</span>     <span class="o">&gt;&gt;</span>   <span class="mi">22</span> <span class="n">LOAD_NAME</span>                <span class="mi">1</span> <span class="p">(</span><span class="k">print</span><span class="p">)</span>
             <span class="mi">24</span> <span class="n">LOAD_NAME</span>                <span class="mi">0</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
             <span class="mi">26</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">1</span>
             <span class="mi">28</span> <span class="n">POP_TOP</span>
             <span class="mi">30</span> <span class="n">LOAD_CONST</span>               <span class="mi">2</span> <span class="p">(</span><span class="bp">None</span><span class="p">)</span>
             <span class="mi">32</span> <span class="n">RETURN_VALUE</span>
</code></pre></div>

<p>Дизассемблированный вывод состоит из нескольких столбцов, краткое описание которых показано на следующем рисунке:</p>
<p><img alt="" src="../../images/lectures/control-statements/bytecode.svg" /></p>
<p>Итак, 6 строк кода были скомпилированы в 17 инструкций (описание инструкций можно найти <a href="https://docs.python.org/3/library/dis.html#python-bytecode-instructions">тут</a>). Первые две инструкции соответствуют связыванию имени <code>x</code> со значением <code>0.4</code>. Следующие четыре инструкции посвящены сравнению <code>x</code> с нулем. Если результат сравнения оказался ложью, то мы переходим (<code>POP_JUMP_IF_FALSE</code>) к выполнению инструкции со смещением 18, в противном случае, переменная <code>x</code> связывается со значением <code>0</code> и мы переходим (<code>JUMP_FORWARD</code>) к выполнению инструкции со смещением 22. Последние шесть инструкций предназначены для вывода содержимого <code>x</code>.</p>
<p>Виртуальная машина Python имеет стековую архитектуру, то есть все данные необходимые для выполнения инструкций помещаются (push) на стек или снимаются (pop) с него, такой стек называется стеком данных (data stack или evaluation stack). Для наглядности ниже проиллюстрировано состояние стека при выполнении нескольких первых инструкций:</p>
<p><img alt="" src="../../images/lectures/control-statements/stack.svg" /></p>
<p>Как же выполняются интсрукции? Выполнение инструкций происходит в <a href="https://github.com/python/cpython/blob/3.8/Python/ceval.c#L1323">бесконечном цикле</a> с условием в несколько тысяч строк кода, в качестве примера ниже представлен соответствующий Си-код для инструкции <a href="https://github.com/python/cpython/blob/3.8/Python/ceval.c#L2974"><code>COMPARE_OP</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="k">case</span> <span class="nf">TARGET</span><span class="p">(</span><span class="n">COMPARE_OP</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">right</span> <span class="o">=</span> <span class="n">POP</span><span class="p">();</span>
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">left</span> <span class="o">=</span> <span class="n">TOP</span><span class="p">();</span>
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="n">cmp_outcome</span><span class="p">(</span><span class="n">tstate</span><span class="p">,</span> <span class="n">oparg</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">);</span>
    <span class="n">Py_DECREF</span><span class="p">(</span><span class="n">left</span><span class="p">);</span>
    <span class="n">Py_DECREF</span><span class="p">(</span><span class="n">right</span><span class="p">);</span>
    <span class="n">SET_TOP</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
    <span class="n">PREDICT</span><span class="p">(</span><span class="n">POP_JUMP_IF_FALSE</span><span class="p">);</span>
    <span class="n">PREDICT</span><span class="p">(</span><span class="n">POP_JUMP_IF_TRUE</span><span class="p">);</span>
    <span class="n">DISPATCH</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

<p>Инструкция достаточно простая, если кратко, то выполняются следующие шаги:</p>
<ul>
<li>с вершины стека снимаем значение и сохраняем его в переменной <code>right</code>;</li>
<li>в переменную <code>left</code> сохраняем значение, которое находится на вершине стека;</li>
<li>вызываем функцию сравнения для <code>left</code> и <code>right</code> и затем результат сохраняем в переменной <code>res</code>;</li>
<li>уменьшаем счетчик ссылок на <code>left</code> и <code>right</code>;</li>
<li>результат сравнения помещаем на вершину стека «затерев» старое значение;</li>
<li>проверяем, что не возникло ошибок при сравнении;</li>
<li>пытаемся «предсказать» следующую инструкцию и, если возможно, то переходим к ней;</li>
<li>переходим к следующей инструкции на выполнение не по предсказанию.</li>
</ul>
<p>Итак, это наше первое знакомство с виртуальной машиной Python и байт-кодом, на протяжении следующих лекций мы будем постепенно детализировать наше понимание работы виртуальной машины Python, тем не менее мы уже можем пожинать плоды первого знакомства, например, мы можем отвечать на вопросы почему одна форма записи некоторого выражения работает быстрее чем другая (попрбуйте сравнить два способа создания словаря <a href="https://medium.com/@jodylecompte/dict-vs-in-python-whats-the-big-deal-anyway-73e251df8398"><code>dict()</code> и <code>{}</code></a>).</p>
<h2 id="_2">Продолжая говорить об условиях</h2>
<p>В Python есть условные выражения, которые соответствуют тернарному оператору в других языках программирования <sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>:</p>
<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">x</span>
<span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="s2">&quot;x = 0.4; x = 0 if x &lt;= 0 else x; print(x)&quot;</span><span class="p">)</span>
  <span class="mi">1</span>           <span class="mi">0</span> <span class="n">LOAD_CONST</span>               <span class="mi">0</span> <span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>
              <span class="mi">2</span> <span class="n">STORE_NAME</span>               <span class="mi">0</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
              <span class="mi">4</span> <span class="n">LOAD_NAME</span>                <span class="mi">0</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
              <span class="mi">6</span> <span class="n">LOAD_CONST</span>               <span class="mi">1</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
              <span class="mi">8</span> <span class="n">COMPARE_OP</span>               <span class="mi">1</span> <span class="p">(</span><span class="o">&lt;=</span><span class="p">)</span>
             <span class="mi">10</span> <span class="n">POP_JUMP_IF_FALSE</span>       <span class="mi">16</span>
             <span class="mi">12</span> <span class="n">LOAD_CONST</span>               <span class="mi">1</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
             <span class="mi">14</span> <span class="n">JUMP_FORWARD</span>             <span class="mi">2</span> <span class="p">(</span><span class="n">to</span> <span class="mi">18</span><span class="p">)</span>
        <span class="o">&gt;&gt;</span>   <span class="mi">16</span> <span class="n">LOAD_NAME</span>                <span class="mi">0</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="o">&gt;&gt;</span>   <span class="mi">18</span> <span class="n">STORE_NAME</span>               <span class="mi">0</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
             <span class="mi">20</span> <span class="n">LOAD_NAME</span>                <span class="mi">1</span> <span class="p">(</span><span class="k">print</span><span class="p">)</span>
             <span class="mi">22</span> <span class="n">LOAD_NAME</span>                <span class="mi">0</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
             <span class="mi">24</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">1</span>
             <span class="mi">26</span> <span class="n">POP_TOP</span>
             <span class="mi">28</span> <span class="n">LOAD_CONST</span>               <span class="mi">2</span> <span class="p">(</span><span class="bp">None</span><span class="p">)</span>
             <span class="mi">30</span> <span class="n">RETURN_VALUE</span>
</code></pre></div>

<p>Как и в других языках программирования в условиях мы можем использовать несколько логических выражений объединив их с помощью операторов <code>and</code> и <code>or</code> (также можно использовать логическое отрицание с помощью оператора <code>not</code>, а с версии 3.8 стало возможным использовать оператор присваивания <sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup>):</p>
<div class="highlight"><pre><span></span><code><span class="n">email</span> <span class="o">=</span> <span class="s2">&quot;Dementiy@yandex.ru&quot;</span>
<span class="n">domains</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;yandex.ru&quot;</span><span class="p">,</span> <span class="s2">&quot;mail.ru&quot;</span><span class="p">,</span> <span class="s2">&quot;gmail.com&quot;</span><span class="p">]</span>
<span class="k">if</span> <span class="s2">&quot;@&quot;</span> <span class="ow">in</span> <span class="n">email</span> <span class="ow">and</span> <span class="n">email</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">domains</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Email указан верно&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Email указан не верно&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;...&quot;&quot;&quot;</span><span class="p">)</span>
<span class="o">..</span>
  <span class="mi">3</span>          <span class="mi">14</span> <span class="n">LOAD_CONST</span>               <span class="mi">4</span> <span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span>
             <span class="mi">16</span> <span class="n">LOAD_NAME</span>                <span class="mi">0</span> <span class="p">(</span><span class="n">email</span><span class="p">)</span>
             <span class="mi">18</span> <span class="n">COMPARE_OP</span>               <span class="mi">6</span> <span class="p">(</span><span class="ow">in</span><span class="p">)</span>
             <span class="mi">20</span> <span class="n">POP_JUMP_IF_FALSE</span>       <span class="mi">50</span>
             <span class="mi">22</span> <span class="n">LOAD_NAME</span>                <span class="mi">0</span> <span class="p">(</span><span class="n">email</span><span class="p">)</span>
             <span class="mi">24</span> <span class="n">LOAD_ATTR</span>                <span class="mi">2</span> <span class="p">(</span><span class="n">split</span><span class="p">)</span>
             <span class="mi">26</span> <span class="n">LOAD_CONST</span>               <span class="mi">4</span> <span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span>
             <span class="mi">28</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">1</span>
             <span class="mi">30</span> <span class="n">LOAD_CONST</span>               <span class="mi">9</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
             <span class="mi">32</span> <span class="n">BINARY_SUBSCR</span>
             <span class="mi">34</span> <span class="n">LOAD_NAME</span>                <span class="mi">1</span> <span class="p">(</span><span class="n">domains</span><span class="p">)</span>
             <span class="mi">36</span> <span class="n">COMPARE_OP</span>               <span class="mi">6</span> <span class="p">(</span><span class="ow">in</span><span class="p">)</span>
             <span class="mi">38</span> <span class="n">POP_JUMP_IF_FALSE</span>       <span class="mi">50</span>
<span class="o">...</span>
  <span class="mi">6</span>     <span class="o">&gt;&gt;</span>   <span class="mi">50</span> <span class="n">LOAD_NAME</span>                <span class="mi">3</span> <span class="p">(</span><span class="k">print</span><span class="p">)</span>
             <span class="mi">52</span> <span class="n">LOAD_CONST</span>               <span class="mi">7</span> <span class="p">(</span><span class="s1">&#39;Email указан не верно&#39;</span><span class="p">)</span>
             <span class="mi">54</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">1</span>
             <span class="mi">56</span> <span class="n">POP_TOP</span>
<span class="o">...</span>
</code></pre></div>

<p>Обратите внимание на то, как происходит «объединение» условных выражений в байт-коде с помощью оператора <code>and</code>: если символ «собаки» не присутствует в строке с адресом электронной почты, то мы переходим к инструкции по смещению 50 и оставшаяся часть логического выражение не проверяется. Попробуйте заменить логический оператор <code>and</code> на <code>or</code> и посмотреть как изменится байт-код.</p>
<p>Мы можем вкладывать условные конструкции одна в другую, указывая вложенность отступами:</p>
<div class="highlight"><pre><span></span><code><span class="n">mark</span> <span class="o">=</span> <span class="mi">71</span>

<span class="k">if</span> <span class="n">mark</span> <span class="o">&gt;=</span> <span class="mi">91</span><span class="p">:</span>
    <span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">mark</span> <span class="o">&gt;=</span> <span class="mi">85</span><span class="p">:</span>
        <span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;B&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mark</span> <span class="o">&gt;=</span> <span class="mi">75</span><span class="p">:</span>
            <span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mark</span> <span class="o">&gt;=</span> <span class="mi">67</span><span class="p">:</span>
                <span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;D&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mark</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">:</span>
                    <span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;E&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;F&#39;</span>

<span class="k">print</span><span class="p">(</span><span class="n">grade</span><span class="p">)</span>
</code></pre></div>

<p>А можем использовать более короткую форму записи с помощью <code>elif</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">mark</span> <span class="o">=</span> <span class="mi">71</span>

<span class="k">if</span> <span class="n">mark</span> <span class="o">&gt;=</span> <span class="mi">91</span><span class="p">:</span>
    <span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span>
<span class="k">elif</span> <span class="n">mark</span> <span class="o">&gt;=</span> <span class="mi">85</span><span class="p">:</span>
    <span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;B&#39;</span>
<span class="k">elif</span> <span class="n">mark</span> <span class="o">&gt;=</span> <span class="mi">75</span><span class="p">:</span>
    <span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span>
<span class="k">elif</span> <span class="n">mark</span> <span class="o">&gt;=</span> <span class="mi">67</span><span class="p">:</span>
    <span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;D&#39;</span>
<span class="k">elif</span> <span class="n">mark</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">:</span>
    <span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;E&#39;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;F&#39;</span>

<span class="k">print</span><span class="p">(</span><span class="n">grade</span><span class="p">)</span>
</code></pre></div>

<p>Если вы сравните байт-код для приведенных примеров, то он окажется полностью идентичным. Поэтому разница между двумя формами записи <code>if-else-if</code> и <code>if-elif</code> только стилистическая.</p>
<h2 id="_3">Циклы</h2>
<p>Условно циклы можно разделить на циклы со счетчиком и совместные циклы, но с точки зрения байт-кода они эквивалентны. Цикл со счётчиком это цикл, в котором некоторая переменная изменяет своё значение от заданного начального значения до конечного значения с некоторым шагом, и для каждого значения этой переменной тело цикла выполняется один раз.</p>
<p>Общая форма записи циклов со счётчиком следующая:</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">counter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
    <span class="n">expression</span>
</code></pre></div>

<p>Например:</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</code></pre></div>

<p>Ниже представлены различные варианты использования <code>range</code>:</p>
<table>
<thead>
<tr>
<th>Шаблон</th>
<th>Пример</th>
<th>Результат</th>
</tr>
</thead>
<tbody>
<tr>
<td>range(end)</td>
<td>range(5)</td>
<td>[0, 1, 2, 3, 4]</td>
</tr>
<tr>
<td>range(start, end)</td>
<td>range(1, 5)</td>
<td>[1, 2, 3, 4]</td>
</tr>
<tr>
<td>range(start, end, step)</td>
<td>range(1, 10, 2)</td>
<td>[1, 3, 5, 7, 9]</td>
</tr>
</tbody>
</table>
<p>Давайте посмотрим на список инструкций, которые будут выполнены для цикла приведенного выше:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="s2">&quot;for i in range(1, 10, 2): print(i)&quot;</span><span class="p">)</span>
  <span class="mi">1</span>           <span class="mi">0</span> <span class="n">LOAD_NAME</span>                <span class="mi">0</span> <span class="p">(</span><span class="nb">range</span><span class="p">)</span>
              <span class="mi">2</span> <span class="n">LOAD_CONST</span>               <span class="mi">0</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
              <span class="mi">4</span> <span class="n">LOAD_CONST</span>               <span class="mi">1</span> <span class="p">(</span><span class="mi">10</span><span class="p">)</span>
              <span class="mi">6</span> <span class="n">LOAD_CONST</span>               <span class="mi">2</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
              <span class="mi">8</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">3</span>
             <span class="mi">10</span> <span class="n">GET_ITER</span>
        <span class="o">&gt;&gt;</span>   <span class="mi">12</span> <span class="n">FOR_ITER</span>                <span class="mi">12</span> <span class="p">(</span><span class="n">to</span> <span class="mi">26</span><span class="p">)</span>
             <span class="mi">14</span> <span class="n">STORE_NAME</span>               <span class="mi">1</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
             <span class="mi">16</span> <span class="n">LOAD_NAME</span>                <span class="mi">2</span> <span class="p">(</span><span class="k">print</span><span class="p">)</span>
             <span class="mi">18</span> <span class="n">LOAD_NAME</span>                <span class="mi">1</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
             <span class="mi">20</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">1</span>
             <span class="mi">22</span> <span class="n">POP_TOP</span>
             <span class="mi">24</span> <span class="n">JUMP_ABSOLUTE</span>           <span class="mi">12</span>
        <span class="o">&gt;&gt;</span>   <span class="mi">26</span> <span class="n">LOAD_CONST</span>               <span class="mi">3</span> <span class="p">(</span><span class="bp">None</span><span class="p">)</span>
             <span class="mi">28</span> <span class="n">RETURN_VALUE</span>
</code></pre></div>

<p>Инструкция <code>GET_ITER</code> <a href="https://github.com/python/cpython/blob/3.8/Python/ceval.c#L3156">возвращает</a> итератор для объекта, который находится на вершине стека (в нашем примере это <code>range(1,10,2)</code>). <code>FOR_ITER</code> <a href="https://github.com/python/cpython/blob/3.8/Python/ceval.c#L3198">возвращает</a> следующее значение из итератора (в нашем примере это 1,3,5,7,9) и помещает его на вершину стека. Инструкция <code>STORE_NAME</code> снимает значение с вершины стека и связывает его с именем <code>i</code>. Затем выполняется тело цикла (печать переменной <code>i</code>) и все повторяется снова до тех пор пока итератор не будет исчерпан:</p>
<p><img alt="" src="../../images/lectures/control-statements/foriter.svg" /></p>
<p>Рассмотрим еще один пример использования цикла со счетчиком: посчитаем средний балл по некоторой дисциплине для группы студентов из 10 человек:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">random</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
<span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Scores: {scores}&#39;</span><span class="p">)</span>
<span class="c1"># Scores: [12, 98, 45, 30, 2, 3, 100, 2, 44, 82]</span>

<span class="n">mean_score</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">)):</span>
    <span class="n">mean_score</span> <span class="o">+=</span> <span class="n">scores</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="n">mean_score</span> <span class="o">=</span> <span class="n">mean_score</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Mean score: {mean_score}&#39;</span><span class="p">)</span>
<span class="c1"># Mean score: 41.8</span>
</code></pre></div>

<p>Как уже было сказано еще один вид циклов это совместные циклы. Такие циклы задают выполнение некоторой операции для объектов из заданного множества, без явного указания порядка перечисления этих объектов.</p>
<p>Общая форма записи совместных циклов следующая:</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
    <span class="n">expression</span>
</code></pre></div>

<p>Где <code>iterable</code> это итерируемый объект. В роли такого объекта могут выступать строки, списки, кортежи, словари, а также любой класс, объявленный с магическими методомами <code>__iter__</code> или <code>__getitem__</code> (<code>range</code>, как вы могли догадаться, также является итерируемым объектом). Об итерируемых объектах и итераторах более подробно мы будем говорить в одной из следующих лекций.</p>
<p>Если переписать предыдущий пример с использованием совместного цикла, то получим:</p>
<div class="highlight"><pre><span></span><code><span class="n">mean_score</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">scores</span><span class="p">:</span>
    <span class="n">mean_score</span> <span class="o">+=</span> <span class="n">score</span>
<span class="n">mean_score</span> <span class="o">=</span> <span class="n">mean_score</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Mean score: {mean_score}&#39;</span><span class="p">)</span>
<span class="c1"># Mean score: 41.8</span>
</code></pre></div>

<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Если при итерировании нам одновременно необходимо получать «индексы» элементов, то можно воспользоваться «функцией» <code>enumerate()</code>.</p>
</div>
<p>Последний вид циклов это цикл с предусловием — цикл, который выполняется пока истинно некоторое условие, указанное перед его началом. Это условие проверяется до выполнения тела цикла, поэтому тело может быть не выполнено ни разу (если условие с самого начала ложно).</p>
<p>Общая форма записи циклов с предусловием следующая:</p>
<div class="highlight"><pre><span></span><code><span class="k">while</span> <span class="n">condition</span><span class="p">:</span>
    <span class="n">loop_body</span>
</code></pre></div>

<p>Рассмотрим пример вычисления факториала числа <code>n</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">fact</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">5</span>
<span class="k">while</span> <span class="n">n</span><span class="p">:</span>
    <span class="n">fact</span> <span class="o">=</span> <span class="n">fact</span> <span class="o">*</span> <span class="n">n</span>
    <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="k">print</span><span class="p">(</span><span class="n">fact</span><span class="p">)</span> <span class="c1"># 1 * 2 * 3 * 4 * 5 = 120</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;...&quot;&quot;&quot;</span><span class="p">)</span>
  <span class="mi">1</span>           <span class="mi">0</span> <span class="n">LOAD_CONST</span>               <span class="mi">0</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
              <span class="mi">2</span> <span class="n">STORE_NAME</span>               <span class="mi">0</span> <span class="p">(</span><span class="n">fact</span><span class="p">)</span>

  <span class="mi">2</span>           <span class="mi">4</span> <span class="n">LOAD_CONST</span>               <span class="mi">1</span> <span class="p">(</span><span class="mi">5</span><span class="p">)</span>
              <span class="mi">6</span> <span class="n">STORE_NAME</span>               <span class="mi">1</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span>

  <span class="mi">3</span>     <span class="o">&gt;&gt;</span>    <span class="mi">8</span> <span class="n">LOAD_NAME</span>                <span class="mi">1</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span>
             <span class="mi">10</span> <span class="n">POP_JUMP_IF_FALSE</span>       <span class="mi">30</span>

  <span class="mi">4</span>          <span class="mi">12</span> <span class="n">LOAD_NAME</span>                <span class="mi">0</span> <span class="p">(</span><span class="n">fact</span><span class="p">)</span>
             <span class="mi">14</span> <span class="n">LOAD_NAME</span>                <span class="mi">1</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span>
             <span class="mi">16</span> <span class="n">BINARY_MULTIPLY</span>
             <span class="mi">18</span> <span class="n">STORE_NAME</span>               <span class="mi">0</span> <span class="p">(</span><span class="n">fact</span><span class="p">)</span>

  <span class="mi">5</span>          <span class="mi">20</span> <span class="n">LOAD_NAME</span>                <span class="mi">1</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span>
             <span class="mi">22</span> <span class="n">LOAD_CONST</span>               <span class="mi">0</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
             <span class="mi">24</span> <span class="n">INPLACE_SUBTRACT</span>
             <span class="mi">26</span> <span class="n">STORE_NAME</span>               <span class="mi">1</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span>
             <span class="mi">28</span> <span class="n">JUMP_ABSOLUTE</span>            <span class="mi">8</span>

  <span class="mi">6</span>     <span class="o">&gt;&gt;</span>   <span class="mi">30</span> <span class="n">LOAD_NAME</span>                <span class="mi">2</span> <span class="p">(</span><span class="k">print</span><span class="p">)</span>
             <span class="mi">32</span> <span class="n">LOAD_NAME</span>                <span class="mi">0</span> <span class="p">(</span><span class="n">fact</span><span class="p">)</span>
             <span class="mi">34</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">1</span>
             <span class="mi">36</span> <span class="n">POP_TOP</span>
             <span class="mi">38</span> <span class="n">LOAD_CONST</span>               <span class="mi">2</span> <span class="p">(</span><span class="bp">None</span><span class="p">)</span>
             <span class="mi">40</span> <span class="n">RETURN_VALUE</span>
</code></pre></div>

<p>С точки зрения байт-кода цикл <code>while</code> не сложнее условных конструкций, если условие ложно, то мы переходим (<code>POP_JUMP_IF_FALSE</code>) к первой инструкции после тела цикла, в противном случае выполняется тело цикла и осуществляется безусловный переход (<code>JUMP_ABSOLUTE</code>) к повторной проверке условия.</p>
<h3>Досрочный выход из цикла</h3>
<p>Команда досрочного выхода <code>break</code> применяется, когда необходимо прервать выполнение цикла, в котором условие выхода ещё не достигнуто:</p>
<div class="highlight"><pre><span></span><code><span class="n">n</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">guess</span> <span class="o">=</span> <span class="n">n</span>
<span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1E-9</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">guess</span>
    <span class="n">guess</span> <span class="o">=</span> <span class="p">(</span><span class="n">guess</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="n">guess</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">guess</span> <span class="o">-</span> <span class="n">last</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">epsilon</span><span class="p">:</span>
        <span class="k">break</span>
<span class="k">print</span><span class="p">(</span><span class="n">guess</span><span class="p">)</span>
<span class="c1"># 3.0</span>
</code></pre></div>

<p>Давайте посмотрим на байт-код:</p>
<div class="highlight"><pre><span></span><code><span class="o">...</span>
  <span class="mi">5</span>     <span class="o">&gt;&gt;</span>   <span class="mi">12</span> <span class="n">LOAD_NAME</span>                <span class="mi">1</span> <span class="p">(</span><span class="n">guess</span><span class="p">)</span>
             <span class="mi">14</span> <span class="n">STORE_NAME</span>               <span class="mi">3</span> <span class="p">(</span><span class="n">last</span><span class="p">)</span>
<span class="o">...</span>
  <span class="mi">7</span>          <span class="mi">32</span> <span class="n">LOAD_NAME</span>                <span class="mi">4</span> <span class="p">(</span><span class="nb">abs</span><span class="p">)</span>
             <span class="mi">34</span> <span class="n">LOAD_NAME</span>                <span class="mi">1</span> <span class="p">(</span><span class="n">guess</span><span class="p">)</span>
             <span class="mi">36</span> <span class="n">LOAD_NAME</span>                <span class="mi">3</span> <span class="p">(</span><span class="n">last</span><span class="p">)</span>
             <span class="mi">38</span> <span class="n">BINARY_SUBTRACT</span>
             <span class="mi">40</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">1</span>
             <span class="mi">42</span> <span class="n">LOAD_NAME</span>                <span class="mi">2</span> <span class="p">(</span><span class="n">epsilon</span><span class="p">)</span>
             <span class="mi">44</span> <span class="n">COMPARE_OP</span>               <span class="mi">0</span> <span class="p">(</span><span class="o">&lt;</span><span class="p">)</span>
             <span class="mi">46</span> <span class="n">POP_JUMP_IF_FALSE</span>       <span class="mi">12</span>

  <span class="mi">8</span>          <span class="mi">48</span> <span class="n">JUMP_ABSOLUTE</span>           <span class="mi">52</span>
             <span class="mi">50</span> <span class="n">JUMP_ABSOLUTE</span>           <span class="mi">12</span>

  <span class="mi">9</span>     <span class="o">&gt;&gt;</span>   <span class="mi">52</span> <span class="n">LOAD_NAME</span>                <span class="mi">5</span> <span class="p">(</span><span class="k">print</span><span class="p">)</span>
<span class="o">...</span>
</code></pre></div>

<p>Обратите внимание, что инструкция со смещением 50 никогда не будет выполнена, так как цикл является бесконечным. Выход из цикла осуществляется с помощью оператора <code>break</code> и соотвествующей инструкции <code>JUMP_ABSOLUTE</code>, которая выполняется при условии, что мы достигли необходимой точности при вычислении квадратного корня.</p>
<h3>Пропуск итерации</h3>
<p>Оператор <code>continue</code> применяется, когда в текущей итерации цикла необходимо пропустить все команды до конца тела цикла, но при этом сам цикл прерываться не должен, условия продолжения или выхода должны вычисляться обычным образом. Рассмотрим простой пример, допустим мы хотим посчитать средний балл, но в данных могут присутствовать пропуски, которые мы не должны учитывать:</p>
<div class="highlight"><pre><span></span><code><span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="n">scores</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Scores: {scores}&#39;</span><span class="p">)</span>
<span class="c1"># Scores: [78, None, 1, 11, 23, 19, 79, None, None, 61, 59, 91, 14]</span>

<span class="n">mean_score</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">scores</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">score</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">mean_score</span> <span class="o">+=</span> <span class="n">score</span>
    <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">mean_score</span> <span class="o">=</span> <span class="n">mean_score</span> <span class="o">/</span> <span class="n">n</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Mean score is {mean_score} for {n} scores&#39;</span><span class="p">)</span>
<span class="c1"># Mean score is 43.6 for 10 scores</span>
</code></pre></div>

<p>С точки зрения байт-кода оператор <code>continue</code> представлен простой инструкцией безусловного перехода <code>JUMP_ABSOLUTE</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>У всех видов циклов есть необязательная ветвь <a href="https://docs.python.org/3/tutorial/controlflow.html#break-and-continue-statements-and-else-clauses-on-loops"><code>else</code></a>.</p>
</div>
<h2 id="_4">Исключения</h2>
<p>Если вы попробуете вычислить выражение <code>1 / 0</code> в интерпретаторе Python, то будет порождено исключение <code>ZeroDivisionError</code> (ошибка деления на ноль). Существует (как минимум) три различимых вида ошибок:</p>
<ul>
<li>синтаксические ошибки (syntax errors);</li>
<li><a href="https://ru.wikipedia.org/wiki/%D0%9B%D0%BE%D0%B3%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F_%D0%BE%D1%88%D0%B8%D0%B1%D0%BA%D0%B0_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)">логические ошибки</a> (logic errors) - в программировании логической ошибкой называется баг, который приводит к некорректной работе программы, но не к краху программы;</li>
<li>и исключения (exceptions).</li>
</ul>
<p>Исключения бывают разных типов и тип исключения выводится в сообщении об ошибке, например <code>ZeroDivisionError</code>, <code>IndexError</code>, <code>KeyError</code>, <code>ValueError</code> и т.д. Для работы с исключениями используется конструкция <code>try...except</code> <sup id="fnref:3"><a class="footnote-ref" href="#fn:3">3</a></sup>:</p>
<div class="highlight"><pre><span></span><code><span class="k">try</span><span class="p">:</span>
    <span class="mi">1</span> <span class="o">/</span> <span class="mi">0</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
</code></pre></div>

<p>Давайте рассмотрим список инструкций, которые будут выполнены виртуальной машиной Python:</p>
<div class="highlight"><pre><span></span><code>  <span class="mi">1</span>           <span class="mi">0</span> <span class="n">SETUP_FINALLY</span>           <span class="mi">12</span> <span class="p">(</span><span class="n">to</span> <span class="mi">14</span><span class="p">)</span>

  <span class="mi">2</span>           <span class="mi">2</span> <span class="n">LOAD_CONST</span>               <span class="mi">0</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
              <span class="mi">4</span> <span class="n">LOAD_CONST</span>               <span class="mi">1</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
              <span class="mi">6</span> <span class="n">BINARY_TRUE_DIVIDE</span>
              <span class="mi">8</span> <span class="n">POP_TOP</span>
             <span class="mi">10</span> <span class="n">POP_BLOCK</span>
             <span class="mi">12</span> <span class="n">JUMP_FORWARD</span>            <span class="mi">12</span> <span class="p">(</span><span class="n">to</span> <span class="mi">26</span><span class="p">)</span>

  <span class="mi">3</span>     <span class="o">&gt;&gt;</span>   <span class="mi">14</span> <span class="n">POP_TOP</span>
             <span class="mi">16</span> <span class="n">POP_TOP</span>
             <span class="mi">18</span> <span class="n">POP_TOP</span>

  <span class="mi">4</span>          <span class="mi">20</span> <span class="n">POP_EXCEPT</span>
             <span class="mi">22</span> <span class="n">JUMP_FORWARD</span>             <span class="mi">2</span> <span class="p">(</span><span class="n">to</span> <span class="mi">26</span><span class="p">)</span>
             <span class="mi">24</span> <span class="n">END_FINALLY</span>
        <span class="o">&gt;&gt;</span>   <span class="mi">26</span> <span class="n">LOAD_CONST</span>               <span class="mi">2</span> <span class="p">(</span><span class="bp">None</span><span class="p">)</span>
             <span class="mi">28</span> <span class="n">RETURN_VALUE</span>
</code></pre></div>

<p>Вам уже должны быть знакомы инструкции соответствующие второй строке: на стек данных помещаются два значения, выполняется операция деления, результат снимается с вершины стека и наконец осуществляется переход к инструкции по смещению 26. Но остаются вопросы: «Каким будет порядок выполнения, если было выброшено исключение?», «Как о нем узнает интерпретатор?», «Как оно будет обработано?» и т.д. Давайте начнем с рассмотрения инструкции <code>SETUP_FINALLY</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">case</span> <span class="nf">TARGET</span><span class="p">(</span><span class="n">SETUP_FINALLY</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
    <span class="cm">/* NOTE: If you add any new block-setup opcodes that</span>
<span class="cm">        are not try/except/finally handlers, you may need</span>
<span class="cm">        to update the PyGen_NeedsFinalizing() function.</span>
<span class="cm">        */</span>

    <span class="n">PyFrame_BlockSetup</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">SETUP_FINALLY</span><span class="p">,</span> <span class="n">INSTR_OFFSET</span><span class="p">()</span> <span class="o">+</span> <span class="n">oparg</span><span class="p">,</span>
                        <span class="n">STACK_LEVEL</span><span class="p">());</span>
    <span class="n">DISPATCH</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

<p>Кроме стека данных, о котором мы говорили ранее, есть еще стек блоков (block stack) ограниченного размера<sup id="fnref:4"><a class="footnote-ref" href="#fn:4">4</a></sup>, который используется для «открутки» стека данных на момент входа в <code>try</code> или контекстный менеджер <code>with</code> <sup id="fnref:5"><a class="footnote-ref" href="#fn:5">5</a></sup>. В обработчике инструкции <code>SETUP_FINALLY</code> происходит вызов функции <a href="https://github.com/python/cpython/blob/3.8/Objects/frameobject.c#L741"><code>PyFrame_BlockSetup</code></a>, которая помещает на стек блоков новый «элемент», со следующими аргументами: указатель на текущий фрейм (о фреймах мы будем говорить в одной из следующих лекций), тип блока, адрес обработчика (адрес инструкции, на которую следует перейти, если было выброшено исключение) и текущая глубина стека данных (до какого момента мы будем «откручивать» стек данных в случае возникновения исключения):</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span>
<span class="nf">PyFrame_BlockSetup</span><span class="p">(</span><span class="n">PyFrameObject</span> <span class="o">*</span><span class="n">f</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">handler</span><span class="p">,</span> <span class="kt">int</span> <span class="n">level</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">PyTryBlock</span> <span class="o">*</span><span class="n">b</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">f_iblock</span> <span class="o">&gt;=</span> <span class="n">CO_MAXBLOCKS</span><span class="p">)</span>
        <span class="n">Py_FatalError</span><span class="p">(</span><span class="s">&quot;XXX block stack overflow&quot;</span><span class="p">);</span>
    <span class="n">b</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">f_blockstack</span><span class="p">[</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">f_iblock</span><span class="o">++</span><span class="p">];</span>
    <span class="n">b</span><span class="o">-&gt;</span><span class="n">b_type</span> <span class="o">=</span> <span class="n">type</span><span class="p">;</span>
    <span class="n">b</span><span class="o">-&gt;</span><span class="n">b_level</span> <span class="o">=</span> <span class="n">level</span><span class="p">;</span>
    <span class="n">b</span><span class="o">-&gt;</span><span class="n">b_handler</span> <span class="o">=</span> <span class="n">handler</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">b_type</span><span class="p">;</span>                 <span class="cm">/* what kind of block this is */</span>
    <span class="kt">int</span> <span class="n">b_handler</span><span class="p">;</span>              <span class="cm">/* where to jump to find handler */</span>
    <span class="kt">int</span> <span class="n">b_level</span><span class="p">;</span>                <span class="cm">/* value stack level to pop to */</span>
<span class="p">}</span> <span class="n">PyTryBlock</span><span class="p">;</span>
</code></pre></div>

<p>Если инструкция <code>SETUP_FINALLY</code> помещает в стек блоков новый элемент, то инструкция <code>POP_BLOCK</code> выталкивает элемент из стека блоков:</p>
<div class="highlight"><pre><span></span><code><span class="k">case</span> <span class="nf">TARGET</span><span class="p">(</span><span class="n">POP_BLOCK</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
    <span class="n">PREDICTED</span><span class="p">(</span><span class="n">POP_BLOCK</span><span class="p">);</span>
    <span class="n">PyFrame_BlockPop</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
    <span class="n">DISPATCH</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">PyTryBlock</span> <span class="o">*</span>
<span class="nf">PyFrame_BlockPop</span><span class="p">(</span><span class="n">PyFrameObject</span> <span class="o">*</span><span class="n">f</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">PyTryBlock</span> <span class="o">*</span><span class="n">b</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">f_iblock</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">Py_FatalError</span><span class="p">(</span><span class="s">&quot;XXX block stack underflow&quot;</span><span class="p">);</span>
    <span class="n">b</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">f_blockstack</span><span class="p">[</span><span class="o">--</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">f_iblock</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>Как же интерпретатор узнает о том, что было порождено исключение? Давайте рассмотрим инструкцию <code>BINARY_TRUE_DIVIDE</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">case</span> <span class="nf">TARGET</span><span class="p">(</span><span class="n">BINARY_TRUE_DIVIDE</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">divisor</span> <span class="o">=</span> <span class="n">POP</span><span class="p">();</span>
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">dividend</span> <span class="o">=</span> <span class="n">TOP</span><span class="p">();</span>
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">quotient</span> <span class="o">=</span> <span class="n">PyNumber_TrueDivide</span><span class="p">(</span><span class="n">dividend</span><span class="p">,</span> <span class="n">divisor</span><span class="p">);</span>
    <span class="n">Py_DECREF</span><span class="p">(</span><span class="n">dividend</span><span class="p">);</span>
    <span class="n">Py_DECREF</span><span class="p">(</span><span class="n">divisor</span><span class="p">);</span>
    <span class="n">SET_TOP</span><span class="p">(</span><span class="n">quotient</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">quotient</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
    <span class="n">DISPATCH</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

<p>Будет вызвана функция <code>PyNumber_TrueDivide</code> и, если проследить всю цепочку вызовов, то мы дойдоем до функции <a href="https://github.com/python/cpython/blob/3.8/Objects/longobject.c#L3881"><code>long_true_divide</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span>
<span class="nf">long_true_divide</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">w</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="n">a_size</span> <span class="o">=</span> <span class="n">Py_ABS</span><span class="p">(</span><span class="n">Py_SIZE</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>
    <span class="n">b_size</span> <span class="o">=</span> <span class="n">Py_ABS</span><span class="p">(</span><span class="n">Py_SIZE</span><span class="p">(</span><span class="n">b</span><span class="p">));</span>
    <span class="n">negate</span> <span class="o">=</span> <span class="p">(</span><span class="n">Py_SIZE</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">Py_SIZE</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">b_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">PyErr_SetString</span><span class="p">(</span><span class="n">PyExc_ZeroDivisionError</span><span class="p">,</span>
                        <span class="s">&quot;division by zero&quot;</span><span class="p">);</span>
        <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
  <span class="nl">error</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>которая возвращает <code>NULL</code> при возникновении различного рода ошибок, например, при делении на ноль. <a href="https://github.com/python/cpython/blob/3.8/Python/errors.c#L210"><code>PyErr_SetString</code></a> позволяет задать тип исключения и сообщение об ошибке. Информация об исключении сохраняется в структуре <a href="https://github.com/python/cpython/blob/3.8/Include/cpython/pystate.h#L51"><code>PyThreadState</code></a>, отражающей состояние текущего потока:</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span>
<span class="nf">_PyErr_Restore</span><span class="p">(</span><span class="n">PyThreadState</span> <span class="o">*</span><span class="n">tstate</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">type</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">value</span><span class="p">,</span>
               <span class="n">PyObject</span> <span class="o">*</span><span class="n">traceback</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="n">tstate</span><span class="o">-&gt;</span><span class="n">curexc_type</span> <span class="o">=</span> <span class="n">type</span><span class="p">;</span>
    <span class="n">tstate</span><span class="o">-&gt;</span><span class="n">curexc_value</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
    <span class="n">tstate</span><span class="o">-&gt;</span><span class="n">curexc_traceback</span> <span class="o">=</span> <span class="n">traceback</span><span class="p">;</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>

<p>Итак, произошла ошибка деления на ноль, а в структуре потока сохранены тип исключения, сообщение об ошибке и трассировочный объект (traceback). Давайте вернемся к инструкции <code>BINARY_TRUE_DIVIDE</code>, если результатом вызова функции <code>PyNumber_TrueDivide</code> является <code>NULL</code>, то осуществляется переход к метке <a href="https://github.com/python/cpython/blob/3.8/Python/ceval.c#L3707"><code>error</code></a>, за которой следует метка <code>exception_unwind</code>, где и происходит откуртка стека данных:</p>
<div class="highlight"><pre><span></span><code><span class="nl">error</span><span class="p">:</span>
    <span class="c1">// ...</span>
<span class="nl">exception_unwind</span><span class="p">:</span>
        <span class="cm">/* Unwind stacks if an exception occurred */</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">f_iblock</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="cm">/* Pop the current block. */</span>
<span class="hll">            <span class="n">PyTryBlock</span> <span class="o">*</span><span class="n">b</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">f_blockstack</span><span class="p">[</span><span class="o">--</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">f_iblock</span><span class="p">];</span>
</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">b_type</span> <span class="o">==</span> <span class="n">EXCEPT_HANDLER</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">UNWIND_EXCEPT_HANDLER</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
<span class="hll">            <span class="n">UNWIND_BLOCK</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
</span>            <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">b_type</span> <span class="o">==</span> <span class="n">SETUP_FINALLY</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">PyObject</span> <span class="o">*</span><span class="n">exc</span><span class="p">,</span> <span class="o">*</span><span class="n">val</span><span class="p">,</span> <span class="o">*</span><span class="n">tb</span><span class="p">;</span>
                <span class="kt">int</span> <span class="n">handler</span> <span class="o">=</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">b_handler</span><span class="p">;</span>
                <span class="n">_PyErr_StackItem</span> <span class="o">*</span><span class="n">exc_info</span> <span class="o">=</span> <span class="n">tstate</span><span class="o">-&gt;</span><span class="n">exc_info</span><span class="p">;</span>
                <span class="cm">/* Beware, this invalidates all b-&gt;b_* fields */</span>
                <span class="n">PyFrame_BlockSetup</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">EXCEPT_HANDLER</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">STACK_LEVEL</span><span class="p">());</span>
                <span class="n">PUSH</span><span class="p">(</span><span class="n">exc_info</span><span class="o">-&gt;</span><span class="n">exc_traceback</span><span class="p">);</span>
                <span class="n">PUSH</span><span class="p">(</span><span class="n">exc_info</span><span class="o">-&gt;</span><span class="n">exc_value</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">exc_info</span><span class="o">-&gt;</span><span class="n">exc_type</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">PUSH</span><span class="p">(</span><span class="n">exc_info</span><span class="o">-&gt;</span><span class="n">exc_type</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="n">Py_INCREF</span><span class="p">(</span><span class="n">Py_None</span><span class="p">);</span>
                    <span class="n">PUSH</span><span class="p">(</span><span class="n">Py_None</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="n">_PyErr_Fetch</span><span class="p">(</span><span class="n">tstate</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">exc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tb</span><span class="p">);</span>
                <span class="cm">/* Make the raw exception data</span>
<span class="cm">                   available to the handler,</span>
<span class="cm">                   so a program can emulate the</span>
<span class="cm">                   Python main loop. */</span>
                <span class="n">_PyErr_NormalizeException</span><span class="p">(</span><span class="n">tstate</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">exc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tb</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">tb</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
                    <span class="n">PyException_SetTraceback</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">tb</span><span class="p">);</span>
                <span class="k">else</span>
                    <span class="nf">PyException_SetTraceback</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Py_None</span><span class="p">);</span>
                <span class="n">Py_INCREF</span><span class="p">(</span><span class="n">exc</span><span class="p">);</span>
                <span class="n">exc_info</span><span class="o">-&gt;</span><span class="n">exc_type</span> <span class="o">=</span> <span class="n">exc</span><span class="p">;</span>
                <span class="n">Py_INCREF</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
                <span class="n">exc_info</span><span class="o">-&gt;</span><span class="n">exc_value</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
                <span class="n">exc_info</span><span class="o">-&gt;</span><span class="n">exc_traceback</span> <span class="o">=</span> <span class="n">tb</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">tb</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                    <span class="n">tb</span> <span class="o">=</span> <span class="n">Py_None</span><span class="p">;</span>
                <span class="n">Py_INCREF</span><span class="p">(</span><span class="n">tb</span><span class="p">);</span>
                <span class="n">PUSH</span><span class="p">(</span><span class="n">tb</span><span class="p">);</span>
                <span class="n">PUSH</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
                <span class="n">PUSH</span><span class="p">(</span><span class="n">exc</span><span class="p">);</span>
<span class="hll">                <span class="n">JUMPTO</span><span class="p">(</span><span class="n">handler</span><span class="p">);</span>
</span>                <span class="cm">/* Resume normal execution */</span>
                <span class="k">goto</span> <span class="n">main_loop</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="cm">/* unwind stack */</span>

        <span class="cm">/* End the loop as we still have an error */</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span> <span class="cm">/* main loop */</span>

    <span class="n">assert</span><span class="p">(</span><span class="n">retval</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">_PyErr_Occurred</span><span class="p">(</span><span class="n">tstate</span><span class="p">));</span>
</code></pre></div>

<p>При обработке исключения «снимается» один блок со стека блоков, раскручивается стек данных до момента входа в блок (см. макрос <code>UNWIND_BLOCK</code>) и наконец осуществляется переход непосредственно к обработчику исключения, в нашем примере это переход к инструкции со смещением 14, где со стека данных последовательно выталкивается три элемента и затем выполняется инструкция <a href="https://github.com/python/cpython/blob/3.8/Python/ceval.c#L2099"><code>POP_EXCEPT</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="k">case</span> <span class="nf">TARGET</span><span class="p">(</span><span class="n">POP_EXCEPT</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">type</span><span class="p">,</span> <span class="o">*</span><span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">traceback</span><span class="p">;</span>
    <span class="n">_PyErr_StackItem</span> <span class="o">*</span><span class="n">exc_info</span><span class="p">;</span>
    <span class="n">PyTryBlock</span> <span class="o">*</span><span class="n">b</span> <span class="o">=</span> <span class="n">PyFrame_BlockPop</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">b_type</span> <span class="o">!=</span> <span class="n">EXCEPT_HANDLER</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_PyErr_SetString</span><span class="p">(</span><span class="n">tstate</span><span class="p">,</span> <span class="n">PyExc_SystemError</span><span class="p">,</span>
                            <span class="s">&quot;popped block is not an except handler&quot;</span><span class="p">);</span>
        <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">STACK_LEVEL</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">b_level</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span>
            <span class="n">STACK_LEVEL</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">b_level</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">exc_info</span> <span class="o">=</span> <span class="n">tstate</span><span class="o">-&gt;</span><span class="n">exc_info</span><span class="p">;</span>
    <span class="n">type</span> <span class="o">=</span> <span class="n">exc_info</span><span class="o">-&gt;</span><span class="n">exc_type</span><span class="p">;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">exc_info</span><span class="o">-&gt;</span><span class="n">exc_value</span><span class="p">;</span>
    <span class="n">traceback</span> <span class="o">=</span> <span class="n">exc_info</span><span class="o">-&gt;</span><span class="n">exc_traceback</span><span class="p">;</span>
    <span class="n">exc_info</span><span class="o">-&gt;</span><span class="n">exc_type</span> <span class="o">=</span> <span class="n">POP</span><span class="p">();</span>
    <span class="n">exc_info</span><span class="o">-&gt;</span><span class="n">exc_value</span> <span class="o">=</span> <span class="n">POP</span><span class="p">();</span>
    <span class="n">exc_info</span><span class="o">-&gt;</span><span class="n">exc_traceback</span> <span class="o">=</span> <span class="n">POP</span><span class="p">();</span>
    <span class="n">Py_XDECREF</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
    <span class="n">Py_XDECREF</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
    <span class="n">Py_XDECREF</span><span class="p">(</span><span class="n">traceback</span><span class="p">);</span>
    <span class="n">DISPATCH</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p><a href="https://www.python.org/dev/peps/pep-0308/">PEP 308 -- Conditional Expressions</a>&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p><a href="https://www.python.org/dev/peps/pep-0572/">PEP 572 -- Assignment Expressions</a>&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p><a href="https://www.python.org/dev/peps/pep-3110/">PEP 3110 -- Catching Exceptions in Python 3000</a>&#160;<a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:4">
<p>Максимальное число вложенных блоков определяется константой <a href="https://github.com/python/cpython/blob/3.8/Include/code.h#L114"><code>CO_MAXBLOCKS</code></a>, значение которой равно 20. Другими словами, вы можете создать не более 20 вложенных циклов или обработчиков исключений, но на 21 уровне вложенности вы получите ошибку <code>SyntaxError: too many statically nested blocks</code>.&#160;<a class="footnote-backref" href="#fnref:4" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn:5">
<p>До версии 3.8 стек блоков также использовался и для <a href="https://docs.python.org/3.8/whatsnew/3.8.html#cpython-bytecode-changes">циклов</a>.&#160;<a class="footnote-backref" href="#fnref:5" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
                  
                    

<hr>
<div class="md-source-date">
  <small>
    
      Последнее обновление: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">25 июня 2020 г.</span>
    
  </small>
</div>
                  
                
              
              
                


  <h2 id="__comments">Комментарии</h2>
  <div id="disqus_thread"></div>
  <script>var disqus_config=function(){this.page.url="https://dementiy.github.io/lectures/control-statements/",this.page.identifier="lectures/control-statements/"};!function(){var e=document,i=e.createElement("script");i.src="//Dementiy.disqus.com/embed.js",i.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(i)}()</script>

              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../mutable-types/" title="Изменяемые типы данных" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Назад
                </span>
                Изменяемые типы данных
              </div>
            </div>
          </a>
        
        
          <a href="../functions/" title="Функции" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Вперед
                </span>
                Функции
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 - 2020 <a href="https://github.com/Dementiy" target="_blank" rel="noopener">Dmitrii Sorokin</a>

          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/Dementiy" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.d1f5a259.min.js"></script>
      <script src="../../assets/javascripts/bundle.d5fec882.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440", "clipboard.copied": "\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0435\u0440", "search.config.lang": "ru", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430", "search.result.none": "\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e", "search.result.one": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e 1 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435", "search.result.other": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e # \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ["tabs", "instant"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.fae956e7.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>